$(function(){$(".app-musk").fadeOut(1e3),$('[data-toggle="tooltip"]').tooltip({container:"body"}),$('.app-handles [handle="goToTop"]').click(function(){$("html,body").animate({scrollTop:"0px"},300)}),$('.app-handles [handle="fullScreen"]').click(function(){$(this).data("full")?($(".app-right").animate({paddingLeft:"60px"},500,function(){$(this).trigger("resize")}),$(".app-main").animate({marginTop:"48px"},500),$(".app-left").delay(500).show(),$(".app-tab").delay(500).show(),$(this).data("full",0)):($(".app-left").hide(),$(".app-tab").hide(),$(".app-right").animate({paddingLeft:"0px"},500,function(){$(this).trigger("resize")}),$(".app-main").animate({marginTop:"10px"},500),$(this).data("full",1))}),$('[handle="logout"]').click(function(){$.http.get("/team/accounts",{},{success:function(t){if($("#modal-switch-account .account-item").remove(),t.team.length){for(var e="",i=0;i<t.team.length;i++)e+='<dd class="account-item" data-id="'+t.team[i].id+'">'+t.team[i].name+' <i class="iconfont icon-ok"></i></dd>';var n='<dd class="account-item" data-id="'+t.prototype.id+'">'+t.prototype.name+' <i class="iconfont icon-ok"></i></dd>';$("#modal-switch-account .team-accounts").append(e),$("#modal-switch-account .user-accounts").append(n),$('#modal-switch-account .account-item[data-id="'+t.activeId+'"]').addClass("active"),$("#modal-switch-account").modal("show")}else window.location.href="/auth/logout"},error:function(t,e,i){$.message.warn(i)}})}),$("#modal-switch-account").on("click",".account-item:not(.active)",function(){$.http.get("/auth/switch/"+$(this).data("id"))})}),jQuery.extend({http:{get:function(t,e,i){return new this.AjaxCall("GET",t,e||{},i||{})},post:function(t,e,i){return new this.AjaxCall("POST",t,e||{},i||{})},put:function(t,e,i){return new this.AjaxCall("PUT",t,e||{},i||{})},patch:function(t,e,i){return new this.AjaxCall("PATCH",t,e||{},i||{})},delete:function(t,e,i){return new this.AjaxCall("DELETE",t,e||{},i||{})},upload:function(t,e,i){var n={method:"POST",type:"",progress:!0,success:function(){},error:function(){},complete:function(){}},s=$.extend(!0,{},n,i);i.progress&&$.progress.start(),$.ajaxFileUpload(s.method,t,e,function(t){"object"==typeof(t=JSON.parse(t))&&t.status&&t.status<=299?"function"==typeof i.success&&i.success(t):"function"==typeof i.error&&i.error(t),i.progress&&$.progress.done(),"function"==typeof i.complete&&i.complete(t)})},AjaxCall:function(t,e,i,n){var s={headers:{Accept:"application/json; charset=UTF-8"},dataType:"json",progress:!1};this.ajaxOptions=$.extend(!0,{},s,n),n.progress&&$.progress.start(),this.ajaxOptions.type=t,this.ajaxOptions.url=e,this.ajaxOptions.data=i,this.ajaxOptions.success=function(t,e,i){"object"==typeof t&&t.status?"function"==typeof n.success&&n.success(t.data,t.status,t.msg):$.message.alert("系统错误, 请联系管理员")},this.ajaxOptions.error=function(t,e,i){var s=t.responseJSON;void 0!==s&&("object"==typeof s&&s.status?302!=s.status?401!=s.status?s.status>=500?$.message.alert(s.msg):"function"==typeof n.error&&n.error(s.data,s.status,s.msg):$.message.pity("您尚未登录或账户已过期, 请重新登录",function(){location.href=s.data.redirectUrl}):$.message.tip(s.msg,function(){s.data.redirectUrl&&(location.href=s.data.redirectUrl)}):$.message.alert("系统错误, 请联系管理员"))},this.ajaxOptions.complete=function(t){n.progress&&$.progress.done(),"function"==typeof n.complete&&n.complete()},this.xhr=$.ajax(this.ajaxOptions)}},progress:{html:'<div id="ext-progress"><p class="percentage" style="overflow: hidden;"></p></div>',currentNum:0,percentage:0,$percentage:[],intervalId:null,start:function(){if(this.currentNum++,$("#ext-progress").length||($("body").append(this.html),this.$percentage=$("#ext-progress .percentage")),this.currentNum<=1){var t=this;this.$percentage.css({width:"0%",height:"2px"}),this.intervalId=setInterval(function(){var e=(98-t.percentage)/8;t.set(t.percentage+e)},250)}else this.percentage=98/this.currentNum;return this},set:function(t){if(!(t<0||t>98))return this.percentage=t,this.$percentage.animate({width:this.percentage+"%"},200),this},done:function(){if(0!=this.currentNum)return 0==--this.currentNum&&(clearInterval(this.intervalId),this.$percentage.animate({width:"100%"},50),this.$percentage.animate({height:"0px"},300),this.percentage=0),this}},message:{wrap:'<div id="ext-message"><ul class="message-list"></ul></div>',template:'<li class="message message-<%= color %>"><% if (showCloseBtn) { %><button type="button" class="close">×</button><% } %><%= content %></li>',templateForConfirm:'<div class="unit-confirm"><h5 class="confirm-title"><%= title %></h5><div class="confirm-content">"<%= content %>"</div><div class="confirm-btns"><a class="confirm-yes">确定</a><a class="confirm-no">取消</a></div></div>',$wrap:[],$modalForConfirm:[],tip:function(t,e){var i=this._setWrapOnce()._renderMessage({color:"success animation-fadeInDown",showCloseBtn:!1,content:t});setTimeout(function(){i.fadeOut("slow",function(){$(this).remove(),"function"==typeof e&&e()})},1e3)},pity:function(t,e){var i=this._setWrapOnce()._renderMessage({color:"default animation-fadeInDown",showCloseBtn:!1,content:t});setTimeout(function(){i.fadeOut("slow",function(){$(this).remove(),"function"==typeof e&&e()})},3e3)},notify:function(t){this._setWrapOnce()._renderMessage({color:"success do-slideInDown",showCloseBtn:!0,content:t})},warn:function(t){this._setWrapOnce()._renderMessage({color:"warning animation-shake",showCloseBtn:!0,content:t})},alert:function(t){this._setWrapOnce()._renderMessage({color:"danger animation-shake",showCloseBtn:!0,content:t})},confirm:function(t,e){this._renderModal({title:t,content:e.content?e.content:""});var i=this;this.$modalForConfirm.find(".confirm-yes").click(function(){"function"==typeof e.yes&&e.yes(),i.$modalForConfirm.modal("hide")}),this.$modalForConfirm.find(".confirm-no").click(function(){"function"==typeof e.no&&e.no(),i.$modalForConfirm.modal("hide")})},_setWrapOnce:function(){return this.$wrap.length?this:($("body").append(this.wrap),this.$wrap=$("#ext-message .message-list"),this.$wrap.on("click","button.close",function(){$(this).closest("li.message").fadeOut("fast",function(){$(this).remove()})}),this)},_renderMessage:function(t){var e=_.template(this.template)(t);return this.$wrap.append(e),this.$wrap.find("li:last")},_renderModal:function(t){if(!this.$modalForConfirm.length){$("body").append('<div class="modal fade" id="ext-message-confirm"><div class="modal-dialog modal-sm"><div class="modal-content"></div></div></div>')}this.$modalForConfirm=$("#ext-message-confirm");var e=_.template(this.templateForConfirm)(t);this.$modalForConfirm.find(".modal-content").html(e),this.$modalForConfirm.modal("show")}},ajaxFileUpload:function(t,e,i,n){var s="ajaxFileUpload_"+Math.round(1e4),a='<iframe name="'+s+'" src="/file/upload" width="0" height="0"></iframe>',r='<form method="'+t+'" enctype="multipart/form-data"></form>',o=$("body").append(a).find("iframe:last");o.load(function(){$form=$(window.frames[s].document).find("body").html(r).find("form"),$form.append(i.clone()).trigger("submit"),$(this).unbind("load").load(function(){"function"==typeof n&&n('{"data":{},"status":400,"msg":"success"}'),o.remove()})})},makeShareUrl:function(t,e){$("#modal-share").length||$("body").append('<div id="modal-share"class="modal fade"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">分享链接</h4></div><div class="modal-body"><p class="share-url">...</p><p class="share-tips">复制以上链接发送给好友,无需登录即可访问</p></div><div class="modal-footer"><button type="button"class="btn btn-default"data-dismiss="modal">关闭</button></div></div></div></div>');var i=$("#modal-share").modal("show");$.http.post("/share/create",{type:t,prototypeId:e},{success:function(t){i.find(".share-url").text(t.url)}})},getValByName:function(t,e){var i=$('input[name="'+t+'"], select[name="'+t+'"], textarea[name="'+t+'"]',e);if(!i.length)return null;var n=i.attr("type"),s=i[0].tagName.toLowerCase();if("radio"==n)return i.filter(":checked").val()||"";if("checkbox"==n){var a=[];return i.filter(":checked").each(function(){a.push($(this).val())}),a}return"select"==s&&i.prop("multiple")?i.val()||[]:i.val()||""},getValByNames:function(t,e){for(var i={},n=0;n<t.length;n++){var s=t[n];i[s]=$.getValByName(s,e)}return i},getParam:function(t){var e=new RegExp("(^|&)"+t+"=([^&]*)(&|$)","i"),i=window.location.search.substr(1).match(e);return null!=i?decodeURI(i[2]):null},render:function(t,e){var i=$("#template-"+t).html();return _.template(i)(e)},renderFormTpl:function(t,e,i){var n="tpl-"+t+"-"+e,s=$("#"+n);s.length||($.loadTplSync(t),s=$("#"+n));var a=s.html();return _.template(a)(i)},loadTplSync:function(t){$.ajax({url:"/assets/tpl/"+t+".html",async:!1,success:function(t){$("body").append(t)}})},isRelativeDateTimeRange:function(t){return!(t.indexOf(" ~ ")>0)},parseRelativeDateTimeRange:function(t){var e=this;return this.format="YYYY-MM-DD HH:mm:ss",this.relative={"最近1分钟":function(){return e.parseLatest(1,"m")},"最近5分钟":function(){return e.parseLatest(5,"m")},"最近10分钟":function(){return e.parseLatest(10,"m")},"最近15分钟":function(){return e.parseLatest(15,"m")},"最近30分钟":function(){return e.parseLatest(30,"m")},"最近1小时":function(){return e.parseLatest(1,"h")},"最近3小时":function(){return e.parseLatest(3,"h")},"最近6小时":function(){return e.parseLatest(6,"h")},"最近12小时":function(){return e.parseLatest(12,"h")},"最近24小时":function(){return e.parseLatest(24,"h")},"今天":function(){return moment().format("YYYY-MM-DD 00:00:00")+" ~ "+moment().format(e.format)},"昨天":function(){return moment().subtract(1,"d").format("YYYY-MM-DD 00:00:00")+" ~ "+moment().format("YYYY-MM-DD 00:00:00")},"最近7天":function(){return e.parseLatest(7,"d")},"最近15天":function(){return e.parseLatest(15,"d")},"最近30天":function(){return e.parseLatest(30,"d")},"本月":function(){return moment().format("YYYY-MM-01 00:00:00")+" ~ "+moment().format(e.format)},"上个月":function(){return moment().subtract(1,"M").format("YYYY-MM-01 00:00:00")+" ~ "+moment().format("YYYY-MM-01 00:00:00")},"最近3个月":function(){return e.parseLatest(3,"M")},"最近6个月":function(){return e.parseLatest(3,"M")},"最近12个月":function(){return e.parseLatest(12,"M")}},this.parseLatest=function(t,i){return moment().subtract(t,i).format(e.format)+" ~ "+moment().format(e.format)},this.relative[t]()}}),function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t("object"==typeof exports?require("jquery"):jQuery)}(function(t){function e(t){return o.raw?t:encodeURIComponent(t)}function i(t){return o.raw?t:decodeURIComponent(t)}function n(t){return e(o.json?JSON.stringify(t):String(t))}function s(t){0===t.indexOf('"')&&(t=t.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return t=decodeURIComponent(t.replace(r," ")),o.json?JSON.parse(t):t}catch(t){}}function a(e,i){var n=o.raw?e:s(e);return t.isFunction(i)?i(n):n}var r=/\+/g,o=t.cookie=function(s,r,l){if(void 0!==r&&!t.isFunction(r)){if("number"==typeof(l=t.extend({},o.defaults,l)).expires){var h=l.expires,d=l.expires=new Date;d.setTime(+d+864e5*h)}return document.cookie=[e(s),"=",n(r),l.expires?"; expires="+l.expires.toUTCString():"",l.path?"; path="+l.path:"",l.domain?"; domain="+l.domain:"",l.secure?"; secure":""].join("")}for(var u=s?void 0:{},c=document.cookie?document.cookie.split("; "):[],p=0,m=c.length;p<m;p++){var f=c[p].split("="),g=i(f.shift()),v=f.join("=");if(s&&s===g){u=a(v,r);break}s||void 0===(v=a(v))||(u[g]=v)}return u};o.defaults={},t.removeCookie=function(e,i){return void 0!==t.cookie(e)&&(t.cookie(e,"",t.extend({},i,{expires:-1})),!t.cookie(e))}}),function(t,e,i){var n=function(t,e){this.$element=[],this.settings={},this.enabled=!1,this.gridOfContent=[],this.initialize(t,e)};n.prototype={defaults:{dragger:"",rightResizer:"",content:"",empty:"",minWidth:250,minHeight:190},initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend({},this.defaults,this.$element.data(),i),this.enabled=!0,this._render()._listen())},toString:function(){var t="";return e(".dashboard-row",this.$element).each(function(){t+='<div class="dashboard-row" style="'+e(this).attr("style")+'">',e(".dashboard-cell",e(this)).each(function(){var i=e(this).children(".chart-item").data("id")||"";t+='<div class="dashboard-cell" data-content="'+i+'" style="'+e(this).attr("style")+'"></div>'}),t+="</div>"}),t},renderCell:function(t){var e=t.data("content");return e?(t.html(this.settings.content),t.children().attr("data-id",e),t.trigger("render.dashboardGrid")):t.html(this.settings.empty),this},removeCell:function(t){var e=t.parent();return t.remove(),this._adjustEmptyCell(e),this.$element.trigger("change.dashboardGrid"),this},_render:function(){var t=this;return this.$element.find(".dashboard-cell").each(function(){t.renderCell(e(this))}),this},_listen:function(){var t=this;return this.$element.on("mousedown",this.settings.dragger,function(i){t._drag(i,e(this).closest(".dashboard-cell"))}),this.$element.on("mousedown",this.settings.rightResizer,function(i){t._resize(i,e(this).closest(".dashboard-cell"))}),this.$element.on("click",'[handle="createRow"]',function(i){e(this).before('<div class="dashboard-row" style="height: 190px;"><div class="dashboard-cell" style="width: 100%">'+t.settings.empty+"</div></div>"),t.$element.trigger("change.dashboardGrid")}),this.$element.on("click",'[handle="deleteRow"]',function(i){e(this).closest(".dashboard-row").remove(),t.$element.trigger("change.dashboardGrid")}),this},_drag:function(t,i){var n=this,s={x:t.clientX,y:t.clientY};i.addClass("active"),this._setGridOfContent(),document.onmousemove=function(t){var e={x:t.clientX,y:t.clientY},a=e.x-s.x,r=e.y-s.y;i.children().css({top:r,left:a,zIndex:2}),n._setTargetCell(e)},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null;var s=e(".dashboard-cell.target",n.$element),a=i;if(s.length){var r=s.data("content"),o=a.data("content");if(s.data("content",o).removeClass("target"),n.renderCell(s),r)a.data("content",r).removeClass("active"),n.renderCell(a);else{var l=a.parent();a.remove(),n._adjustEmptyCell(l)}n.$element.trigger("change.dashboardGrid")}else a.removeClass("active").children().animate({top:0,left:0,zIndex:0},200,"swing")}},_resize:function(t,e){var i=this,n={x:t.clientX,y:t.clientY},s=e.parent(),a=e.next(".dashboard-cell").length?e.next(".dashboard-cell").first():i._appendEmptyCell(s),r={row:{width:s.outerWidth(),height:s.outerHeight()},cell:{width:e.outerWidth()},nextCell:{width:i._countTdWidth(a)}},o=!!a.children(".chart-empty").length;document.onmousemove=function(t){var l={x:t.clientX,y:t.clientY},h=l.x-n.x,d=l.y-n.y,u={row:{height:r.row.height+d},cell:{width:r.cell.width+h},nextCell:{width:r.nextCell.width-h}};u.row.height>=i.settings.minHeight&&s.css("height",u.row.height),u.cell.width<0||u.nextCell.width<=0||(!o&&u.cell.width>=i.settings.minWidth&&u.nextCell.width>=i.settings.minWidth&&(e.css("width",u.cell.width/r.row.width*100+"%"),a.css("width",u.nextCell.width/r.row.width*100+"%")),o&&(u.cell.width>=i.settings.minWidth&&(e.css("width",u.cell.width/r.row.width*100+"%"),a.css("width",u.nextCell.width/r.row.width*100+"%")),u.nextCell.width>=i.settings.minWidth?a.children().show():a.children().hide()))},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,i._adjustSize(s,e,a)}},_appendEmptyCell:function(t){t.append('<div class="dashboard-cell" data-content="" style="width: 0px">'+this.settings.empty+"</div>");var e=t.children(":last");return e.children().hide(),e},_countTdWidth:function(t){var i=t.parent().outerWidth(),n=0;return t.siblings().each(function(){n+=e(this).outerWidth()}),i-n-1},_adjustSize:function(t,e,i){var n=this,s={row:{width:t.outerWidth(),height:t.outerHeight()},cell:{width:e.outerWidth()},nextCell:{width:i.outerWidth()}},a={row:{height:n._getAdjustNum(s.row.height)},cell:{width:0},nextCell:{width:0}};!i.data("content")&&s.nextCell.width<this.settings.minWidth?(a.cell.width=s.cell.width+s.nextCell.width,i.remove()):(a.cell.width=n._getAdjustNum(s.cell.width),a.nextCell.width=s.cell.width+s.nextCell.width-a.cell.width,i.animate({width:a.nextCell.width/s.row.width*100+"%"},200,"swing")),e.animate({width:a.cell.width/s.row.width*100+"%"},200,"swing"),t.animate({height:a.row.height},200,"swing",function(){t.children(".dashboard-cell").trigger("resized.dashboardGrid"),n.$element.trigger("change.dashboardGrid")})},_getAdjustNum:function(t){return 10*Math.round(t/10)},_setGridOfContent:function(){var t=[];e(".dashboard-cell > div",this.$element).each(function(){if(!e(this).parent().hasClass("active")){var i=e(this).offset();t.push({tl:i,br:{top:i.top+e(this).outerHeight(),left:i.left+e(this).outerWidth()},$cell:e(this).parent()})}}),this.gridOfContent=t},_setTargetCell:function(t){for(var e=0;e<this.gridOfContent.length;e++){var i=this.gridOfContent[e];t.y>=i.tl.top&&t.x>=i.tl.left&&t.y<=i.br.top&&t.x<=i.br.left?i.$cell.addClass("target"):i.$cell.removeClass("target")}},_adjustEmptyCell:function(t){var e=t.find(".chart-empty"),i=[];(i=e.length?e.parent():this._appendEmptyCell(t)).css("width",this._countTdWidth(i)/t.outerWidth()*100+"%").children().show()}},e.fn.dashboardGrid=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.dashboardGrid");if("div"==e(this)[0].tagName.toLowerCase()){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.dashboardGrid",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t){function e(){return new Date(Date.UTC.apply(Date,arguments))}var i=function(e,i){var n=this;this.element=t(e),this.container=i.container||"body",this.language=i.language||this.element.data("date-language")||"en",this.language=this.language in s?this.language:"en",this.isRTL=s[this.language].rtl||!1,this.formatType=i.formatType||this.element.data("format-type")||"standard",this.format=a.parseFormat(i.format||this.element.data("date-format")||s[this.language].format||a.getDefaultFormat(this.formatType,"input"),this.formatType),this.isInline=!1,this.isVisible=!1,this.isInput=this.element.is("input"),this.fontAwesome=i.fontAwesome||this.element.data("font-awesome")||!1,this.bootcssVer=i.bootcssVer||(this.isInput?this.element.is(".form-control")?3:2:this.bootcssVer=this.element.is(".input-group")?3:2),this.component=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-th, .input-group-addon .glyphicon-time, .input-group-addon .glyphicon-calendar, .input-group-addon .glyphicon-calendar, .input-group-addon .fa-calendar, .input-group-addon .fa-clock-o").parent():this.element.find(".add-on .icon-th, .add-on .icon-time, .add-on .icon-calendar .fa-calendar .fa-clock-o").parent()),this.componentReset=!!this.element.is(".date")&&(3==this.bootcssVer?this.element.find(".input-group-addon .glyphicon-remove, .input-group-addon .fa-times").parent():this.element.find(".add-on .icon-remove, .add-on .fa-times").parent()),this.hasInput=this.component&&this.element.find("input").length,this.component&&0===this.component.length&&(this.component=!1),this.linkField=i.linkField||this.element.data("link-field")||!1,this.linkFormat=a.parseFormat(i.linkFormat||this.element.data("link-format")||a.getDefaultFormat(this.formatType,"link"),this.formatType),this.minuteStep=i.minuteStep||this.element.data("minute-step")||5,this.pickerPosition=i.pickerPosition||this.element.data("picker-position")||"bottom-right",this.showMeridian=i.showMeridian||this.element.data("show-meridian")||!1,this.initialDate=i.initialDate||new Date,this.zIndex=i.zIndex||this.element.data("z-index")||void 0,this.icons={leftArrow:this.fontAwesome?"fa-arrow-left":3===this.bootcssVer?"glyphicon-arrow-left":"icon-arrow-left",rightArrow:this.fontAwesome?"fa-arrow-right":3===this.bootcssVer?"glyphicon-arrow-right":"icon-arrow-right"},this.icontype=this.fontAwesome?"fa":"glyphicon",this._attachEvents(),this.formatViewType="datetime","formatViewType"in i?this.formatViewType=i.formatViewType:"formatViewType"in this.element.data()&&(this.formatViewType=this.element.data("formatViewType")),this.minView=0,"minView"in i?this.minView=i.minView:"minView"in this.element.data()&&(this.minView=this.element.data("min-view")),this.minView=a.convertViewMode(this.minView),this.maxView=a.modes.length-1,"maxView"in i?this.maxView=i.maxView:"maxView"in this.element.data()&&(this.maxView=this.element.data("max-view")),this.maxView=a.convertViewMode(this.maxView),this.wheelViewModeNavigation=!1,"wheelViewModeNavigation"in i?this.wheelViewModeNavigation=i.wheelViewModeNavigation:"wheelViewModeNavigation"in this.element.data()&&(this.wheelViewModeNavigation=this.element.data("view-mode-wheel-navigation")),this.wheelViewModeNavigationInverseDirection=!1,"wheelViewModeNavigationInverseDirection"in i?this.wheelViewModeNavigationInverseDirection=i.wheelViewModeNavigationInverseDirection:"wheelViewModeNavigationInverseDirection"in this.element.data()&&(this.wheelViewModeNavigationInverseDirection=this.element.data("view-mode-wheel-navigation-inverse-dir")),this.wheelViewModeNavigationDelay=100,"wheelViewModeNavigationDelay"in i?this.wheelViewModeNavigationDelay=i.wheelViewModeNavigationDelay:"wheelViewModeNavigationDelay"in this.element.data()&&(this.wheelViewModeNavigationDelay=this.element.data("view-mode-wheel-navigation-delay")),this.startViewMode=2,"startView"in i?this.startViewMode=i.startView:"startView"in this.element.data()&&(this.startViewMode=this.element.data("start-view")),this.startViewMode=a.convertViewMode(this.startViewMode),this.viewMode=this.startViewMode,this.viewSelect=this.minView,"viewSelect"in i?this.viewSelect=i.viewSelect:"viewSelect"in this.element.data()&&(this.viewSelect=this.element.data("view-select")),this.viewSelect=a.convertViewMode(this.viewSelect),this.forceParse=!0,"forceParse"in i?this.forceParse=i.forceParse:"dateForceParse"in this.element.data()&&(this.forceParse=this.element.data("date-force-parse"));for(var r=3===this.bootcssVer?a.templateV3:a.template;-1!==r.indexOf("{iconType}");)r=r.replace("{iconType}",this.icontype);for(;-1!==r.indexOf("{leftArrow}");)r=r.replace("{leftArrow}",this.icons.leftArrow);for(;-1!==r.indexOf("{rightArrow}");)r=r.replace("{rightArrow}",this.icons.rightArrow);if(this.picker=t(r).appendTo(this.isInline?this.element:this.container).on({click:t.proxy(this.click,this),mousedown:t.proxy(this.mousedown,this)}),this.wheelViewModeNavigation&&(t.fn.mousewheel?this.picker.on({mousewheel:t.proxy(this.mousewheel,this)}):console.log("Mouse Wheel event is not supported. Please include the jQuery Mouse Wheel plugin before enabling this option")),this.isInline?this.picker.addClass("datetimepicker-inline"):this.picker.addClass("datetimepicker-dropdown-"+this.pickerPosition+" dropdown-menu"),this.isRTL){this.picker.addClass("datetimepicker-rtl");var o=3===this.bootcssVer?".prev span, .next span":".prev i, .next i";this.picker.find(o).toggleClass(this.icons.leftArrow+" "+this.icons.rightArrow)}t(document).on("mousedown",function(e){0===t(e.target).closest(".datetimepicker").length&&n.hide()}),this.autoclose=!1,"autoclose"in i?this.autoclose=i.autoclose:"dateAutoclose"in this.element.data()&&(this.autoclose=this.element.data("date-autoclose")),this.keyboardNavigation=!0,"keyboardNavigation"in i?this.keyboardNavigation=i.keyboardNavigation:"dateKeyboardNavigation"in this.element.data()&&(this.keyboardNavigation=this.element.data("date-keyboard-navigation")),this.todayBtn=i.todayBtn||this.element.data("date-today-btn")||!1,this.todayHighlight=i.todayHighlight||this.element.data("date-today-highlight")||!1,this.weekStart=(i.weekStart||this.element.data("date-weekstart")||s[this.language].weekStart||0)%7,this.weekEnd=(this.weekStart+6)%7,this.startDate=-1/0,this.endDate=1/0,this.daysOfWeekDisabled=[],this.setStartDate(i.startDate||this.element.data("date-startdate")),this.setEndDate(i.endDate||this.element.data("date-enddate")),this.setDaysOfWeekDisabled(i.daysOfWeekDisabled||this.element.data("date-days-of-week-disabled")),this.setMinutesDisabled(i.minutesDisabled||this.element.data("date-minute-disabled")),this.setHoursDisabled(i.hoursDisabled||this.element.data("date-hour-disabled")),this.fillDow(),this.fillMonths(),this.update(),this.showMode(),this.isInline&&this.show()};i.prototype={constructor:i,_events:[],_attachEvents:function(){this._detachEvents(),this.isInput?this._events=[[this.element,{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}]]:this.component&&this.hasInput?(this._events=[[this.element.find("input"),{focus:t.proxy(this.show,this),keyup:t.proxy(this.update,this),keydown:t.proxy(this.keydown,this)}],[this.component,{click:t.proxy(this.show,this)}]],this.componentReset&&this._events.push([this.componentReset,{click:t.proxy(this.reset,this)}])):this.element.is("div")?this.isInline=!0:this._events=[[this.element,{click:t.proxy(this.show,this)}]];for(var e,i,n=0;n<this._events.length;n++)e=this._events[n][0],i=this._events[n][1],e.on(i)},_detachEvents:function(){for(var t,e,i=0;i<this._events.length;i++)t=this._events[i][0],e=this._events[i][1],t.off(e);this._events=[]},show:function(e){this.picker.show(),this.height=this.component?this.component.outerHeight():this.element.outerHeight()+54,this.forceParse&&this.update(),this.place(),t(window).on("resize",t.proxy(this.place,this)),e&&(e.stopPropagation(),e.preventDefault()),this.isVisible=!0,this.element.trigger({type:"show",date:this.date})},hide:function(e){this.isVisible&&(this.isInline||(this.picker.hide(),t(window).off("resize",this.place),this.viewMode=this.startViewMode,this.showMode(),this.isInput||t(document).off("mousedown",this.hide),this.forceParse&&(this.isInput&&this.element.val()||this.hasInput&&this.element.find("input").val())&&this.setValue(),this.isVisible=!1,this.element.trigger({type:"hide",date:this.date})))},remove:function(){this._detachEvents(),this.picker.remove(),delete this.picker,delete this.element.data().datetimepicker},getDate:function(){var t=this.getUTCDate();return new Date(t.getTime()+6e4*t.getTimezoneOffset())},getUTCDate:function(){return this.date},setDate:function(t){this.setUTCDate(new Date(t.getTime()-6e4*t.getTimezoneOffset()))},setUTCDate:function(t){t>=this.startDate&&t<=this.endDate?(this.date=t,this.setValue(),this.viewDate=this.date,this.fill()):this.element.trigger({type:"outOfRange",date:t,startDate:this.startDate,endDate:this.endDate})},setFormat:function(t){this.format=a.parseFormat(t,this.formatType);var e;this.isInput?e=this.element:this.component&&(e=this.element.find("input")),e&&e.val()&&this.setValue()},setValue:function(){var e=this.getFormattedDate();this.isInput?this.element.val(e):(this.component&&this.element.find("input").val(e),this.element.data("date",e)),this.linkField&&t("#"+this.linkField).val(this.getFormattedDate(this.linkFormat))},getFormattedDate:function(t){return void 0==t&&(t=this.format),a.formatDate(this.date,t,this.language,this.formatType)},setStartDate:function(t){this.startDate=t||-1/0,this.startDate!==-1/0&&(this.startDate=a.parseDate(this.startDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setEndDate:function(t){this.endDate=t||1/0,this.endDate!==1/0&&(this.endDate=a.parseDate(this.endDate,this.format,this.language,this.formatType)),this.update(),this.updateNavArrows()},setDaysOfWeekDisabled:function(e){this.daysOfWeekDisabled=e||[],t.isArray(this.daysOfWeekDisabled)||(this.daysOfWeekDisabled=this.daysOfWeekDisabled.split(/,\s*/)),this.daysOfWeekDisabled=t.map(this.daysOfWeekDisabled,function(t){return parseInt(t,10)}),this.update(),this.updateNavArrows()},setMinutesDisabled:function(e){this.minutesDisabled=e||[],t.isArray(this.minutesDisabled)||(this.minutesDisabled=this.minutesDisabled.split(/,\s*/)),this.minutesDisabled=t.map(this.minutesDisabled,function(t){return parseInt(t,10)}),this.update(),this.updateNavArrows()},setHoursDisabled:function(e){this.hoursDisabled=e||[],t.isArray(this.hoursDisabled)||(this.hoursDisabled=this.hoursDisabled.split(/,\s*/)),this.hoursDisabled=t.map(this.hoursDisabled,function(t){return parseInt(t,10)}),this.update(),this.updateNavArrows()},place:function(){if(!this.isInline){if(!this.zIndex){var e=0;t("div").each(function(){var i=parseInt(t(this).css("zIndex"),10);i>e&&(e=i)}),this.zIndex=e+10}var i,n,s,a;a=this.container instanceof t?this.container.offset():t(this.container).offset(),this.component?(s=(i=this.component.offset()).left,"bottom-left"!=this.pickerPosition&&"top-left"!=this.pickerPosition||(s+=this.component.outerWidth()-this.picker.outerWidth())):s=(i=this.element.offset()).left,s+220>document.body.clientWidth&&(s=document.body.clientWidth-220),n="top-left"==this.pickerPosition||"top-right"==this.pickerPosition?i.top-this.picker.outerHeight():i.top+this.height,n-=a.top,s-=a.left,"body"!=this.container&&(n+=document.body.scrollTop),this.picker.css({top:n,left:s,zIndex:this.zIndex})}},update:function(){var t,e=!1;arguments&&arguments.length&&("string"==typeof arguments[0]||arguments[0]instanceof Date)?(t=arguments[0],e=!0):("string"==typeof(t=(this.isInput?this.element.val():this.element.find("input").val())||this.element.data("date")||this.initialDate)||t instanceof String)&&(t=t.replace(/^\s+|\s+$/g,"")),t||(t=new Date,e=!1),this.date=a.parseDate(t,this.format,this.language,this.formatType),e&&this.setValue(),this.date<this.startDate?this.viewDate=new Date(this.startDate):this.date>this.endDate?this.viewDate=new Date(this.endDate):this.viewDate=new Date(this.date),this.fill()},fillDow:function(){for(var t=this.weekStart,e="<tr>";t<this.weekStart+7;)e+='<th class="dow">'+s[this.language].daysMin[t++%7]+"</th>";e+="</tr>",this.picker.find(".datetimepicker-days thead").append(e)},fillMonths:function(){for(var t="",e=0;e<12;)t+='<span class="month">'+s[this.language].monthsShort[e++]+"</span>";this.picker.find(".datetimepicker-months td").html(t)},fill:function(){if(null!=this.date&&null!=this.viewDate){var i=new Date(this.viewDate),n=i.getUTCFullYear(),r=i.getUTCMonth(),o=i.getUTCDate(),l=i.getUTCHours(),h=i.getUTCMinutes(),d=this.startDate!==-1/0?this.startDate.getUTCFullYear():-1/0,u=this.startDate!==-1/0?this.startDate.getUTCMonth()+1:-1/0,c=this.endDate!==1/0?this.endDate.getUTCFullYear():1/0,p=this.endDate!==1/0?this.endDate.getUTCMonth()+1:1/0,m=new e(this.date.getUTCFullYear(),this.date.getUTCMonth(),this.date.getUTCDate()).valueOf(),f=new Date;if(this.picker.find(".datetimepicker-days thead th:eq(1)").text(s[this.language].months[r]+" "+n),"time"==this.formatViewType){var g=this.getFormattedDate();this.picker.find(".datetimepicker-hours thead th:eq(1)").text(g),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(g)}else this.picker.find(".datetimepicker-hours thead th:eq(1)").text(o+" "+s[this.language].months[r]+" "+n),this.picker.find(".datetimepicker-minutes thead th:eq(1)").text(o+" "+s[this.language].months[r]+" "+n);this.picker.find("tfoot th.today").text(s[this.language].today).toggle(!1!==this.todayBtn),this.updateNavArrows(),this.fillMonths();var v=e(n,r-1,28,0,0,0,0),b=a.getDaysInMonth(v.getUTCFullYear(),v.getUTCMonth());v.setUTCDate(b),v.setUTCDate(b-(v.getUTCDay()-this.weekStart+7)%7);var w=new Date(v);w.setUTCDate(w.getUTCDate()+42),w=w.valueOf();for(var y,$=[];v.valueOf()<w;)v.getUTCDay()==this.weekStart&&$.push("<tr>"),y="",v.getUTCFullYear()<n||v.getUTCFullYear()==n&&v.getUTCMonth()<r?y+=" old":(v.getUTCFullYear()>n||v.getUTCFullYear()==n&&v.getUTCMonth()>r)&&(y+=" new"),this.todayHighlight&&v.getUTCFullYear()==f.getFullYear()&&v.getUTCMonth()==f.getMonth()&&v.getUTCDate()==f.getDate()&&(y+=" today"),v.valueOf()==m&&(y+=" active"),(v.valueOf()+864e5<=this.startDate||v.valueOf()>this.endDate||-1!==t.inArray(v.getUTCDay(),this.daysOfWeekDisabled))&&(y+=" disabled"),$.push('<td class="day'+y+'">'+v.getUTCDate()+"</td>"),v.getUTCDay()==this.weekEnd&&$.push("</tr>"),v.setUTCDate(v.getUTCDate()+1);this.picker.find(".datetimepicker-days tbody").empty().append($.join("")),$=[];for(var _="",D="",x="",k=this.hoursDisabled||[],T=0;T<24;T++)-1===k.indexOf(T)&&(y="",(M=e(n,r,o,T)).valueOf()+36e5<=this.startDate||M.valueOf()>this.endDate?y+=" disabled":l==T&&(y+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?((D=T<12?s[this.language].meridiem[0]:s[this.language].meridiem[1])!=x&&(""!=x&&$.push("</fieldset>"),$.push('<fieldset class="hour"><legend>'+D.toUpperCase()+"</legend>")),x=D,_=T%12?T%12:12,$.push('<span class="hour'+y+" hour_"+(T<12?"am":"pm")+'">'+_+"</span>"),23==T&&$.push("</fieldset>")):(_=T+":00",$.push('<span class="hour'+y+'">'+_+"</span>")));this.picker.find(".datetimepicker-hours td").html($.join("")),$=[],_="",D="",x="";for(var C=this.minutesDisabled||[],T=0;T<60;T+=this.minuteStep)if(-1===C.indexOf(T)){var M=e(n,r,o,l,T,0);y="",M.valueOf()<this.startDate||M.valueOf()>this.endDate?y+=" disabled":Math.floor(h/this.minuteStep)==Math.floor(T/this.minuteStep)&&(y+=" active"),this.showMeridian&&2==s[this.language].meridiem.length?((D=l<12?s[this.language].meridiem[0]:s[this.language].meridiem[1])!=x&&(""!=x&&$.push("</fieldset>"),$.push('<fieldset class="minute"><legend>'+D.toUpperCase()+"</legend>")),x=D,_=l%12?l%12:12,$.push('<span class="minute'+y+'">'+_+":"+(T<10?"0"+T:T)+"</span>"),59==T&&$.push("</fieldset>")):(_=T+":00",$.push('<span class="minute'+y+'">'+l+":"+(T<10?"0"+T:T)+"</span>"))}this.picker.find(".datetimepicker-minutes td").html($.join(""));var O=this.date.getUTCFullYear(),F=this.picker.find(".datetimepicker-months").find("th:eq(1)").text(n).end().find("span").removeClass("active");O==n&&F.eq(this.date.getUTCMonth()+2).addClass("active"),(n<d||n>c)&&F.addClass("disabled"),n==d&&F.slice(0,u+1).addClass("disabled"),n==c&&F.slice(p).addClass("disabled"),$="",n=10*parseInt(n/10,10);var S=this.picker.find(".datetimepicker-years").find("th:eq(1)").text(n+"-"+(n+9)).end().find("td");n-=1;for(T=-1;T<11;T++)$+='<span class="year'+(-1==T||10==T?" old":"")+(O==n?" active":"")+(n<d||n>c?" disabled":"")+'">'+n+"</span>",n+=1;S.html($),this.place()}},updateNavArrows:function(){var t=new Date(this.viewDate),e=t.getUTCFullYear(),i=t.getUTCMonth(),n=t.getUTCDate(),s=t.getUTCHours();switch(this.viewMode){case 0:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()&&s<=this.startDate.getUTCHours()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()&&s>=this.endDate.getUTCHours()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 1:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()&&n<=this.startDate.getUTCDate()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()&&n>=this.endDate.getUTCDate()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 2:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()&&i<=this.startDate.getUTCMonth()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()&&i>=this.endDate.getUTCMonth()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"});break;case 3:case 4:this.startDate!==-1/0&&e<=this.startDate.getUTCFullYear()?this.picker.find(".prev").css({visibility:"hidden"}):this.picker.find(".prev").css({visibility:"visible"}),this.endDate!==1/0&&e>=this.endDate.getUTCFullYear()?this.picker.find(".next").css({visibility:"hidden"}):this.picker.find(".next").css({visibility:"visible"})}},mousewheel:function(e){if(e.preventDefault(),e.stopPropagation(),!this.wheelPause){this.wheelPause=!0;var i=e.originalEvent.wheelDelta,n=i>0?1:0===i?0:-1;this.wheelViewModeNavigationInverseDirection&&(n=-n),this.showMode(n),setTimeout(t.proxy(function(){this.wheelPause=!1},this),this.wheelViewModeNavigationDelay)}},click:function(i){i.stopPropagation(),i.preventDefault();var n=t(i.target).closest("span, td, th, legend");if(n.is("."+this.icontype)&&(n=t(n).parent().closest("span, td, th, legend")),1==n.length){if(n.is(".disabled"))return void this.element.trigger({type:"outOfRange",date:this.viewDate,startDate:this.startDate,endDate:this.endDate});switch(n[0].nodeName.toLowerCase()){case"th":switch(n[0].className){case"switch":this.showMode(1);break;case"prev":case"next":var s=a.modes[this.viewMode].navStep*("prev"==n[0].className?-1:1);switch(this.viewMode){case 0:this.viewDate=this.moveHour(this.viewDate,s);break;case 1:this.viewDate=this.moveDate(this.viewDate,s);break;case 2:this.viewDate=this.moveMonth(this.viewDate,s);break;case 3:case 4:this.viewDate=this.moveYear(this.viewDate,s)}this.fill(),this.element.trigger({type:n[0].className+":"+this.convertViewModeText(this.viewMode),date:this.viewDate,startDate:this.startDate,endDate:this.endDate});break;case"today":var r=new Date;(r=e(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),0))<this.startDate?r=this.startDate:r>this.endDate&&(r=this.endDate),this.viewMode=this.startViewMode,this.showMode(0),this._setDate(r),this.fill(),this.autoclose&&this.hide()}break;case"span":if(!n.is(".disabled")){var o=this.viewDate.getUTCFullYear(),l=this.viewDate.getUTCMonth(),h=this.viewDate.getUTCDate(),d=this.viewDate.getUTCHours(),u=this.viewDate.getUTCMinutes(),c=this.viewDate.getUTCSeconds();if(n.is(".month")?(this.viewDate.setUTCDate(1),l=n.parent().find("span").index(n),h=this.viewDate.getUTCDate(),this.viewDate.setUTCMonth(l),this.element.trigger({type:"changeMonth",date:this.viewDate}),this.viewSelect>=3&&this._setDate(e(o,l,h,d,u,c,0))):n.is(".year")?(this.viewDate.setUTCDate(1),o=parseInt(n.text(),10)||0,this.viewDate.setUTCFullYear(o),this.element.trigger({type:"changeYear",date:this.viewDate}),this.viewSelect>=4&&this._setDate(e(o,l,h,d,u,c,0))):n.is(".hour")?(d=parseInt(n.text(),10)||0,(n.hasClass("hour_am")||n.hasClass("hour_pm"))&&(12==d&&n.hasClass("hour_am")?d=0:12!=d&&n.hasClass("hour_pm")&&(d+=12)),this.viewDate.setUTCHours(d),this.element.trigger({type:"changeHour",date:this.viewDate}),this.viewSelect>=1&&this._setDate(e(o,l,h,d,u,c,0))):n.is(".minute")&&(u=parseInt(n.text().substr(n.text().indexOf(":")+1),10)||0,this.viewDate.setUTCMinutes(u),this.element.trigger({type:"changeMinute",date:this.viewDate}),this.viewSelect>=0&&this._setDate(e(o,l,h,d,u,c,0))),0!=this.viewMode){p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide()}break;case"td":if(n.is(".day")&&!n.is(".disabled")){var h=parseInt(n.text(),10)||1,o=this.viewDate.getUTCFullYear(),l=this.viewDate.getUTCMonth(),d=this.viewDate.getUTCHours(),u=this.viewDate.getUTCMinutes(),c=this.viewDate.getUTCSeconds();n.is(".old")?0===l?(l=11,o-=1):l-=1:n.is(".new")&&(11==l?(l=0,o+=1):l+=1),this.viewDate.setUTCFullYear(o),this.viewDate.setUTCMonth(l,h),this.element.trigger({type:"changeDay",date:this.viewDate}),this.viewSelect>=2&&this._setDate(e(o,l,h,d,u,c,0))}var p=this.viewMode;this.showMode(-1),this.fill(),p==this.viewMode&&this.autoclose&&this.hide()}}},_setDate:function(t,e){e&&"date"!=e||(this.date=t),e&&"view"!=e||(this.viewDate=t),this.fill(),this.setValue();var i;this.isInput?i=this.element:this.component&&(i=this.element.find("input")),i&&(i.change(),this.autoclose),this.element.trigger({type:"changeDate",date:this.date})},moveMinute:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCMinutes(i.getUTCMinutes()+e*this.minuteStep),i},moveHour:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCHours(i.getUTCHours()+e),i},moveDate:function(t,e){if(!e)return t;var i=new Date(t.valueOf());return i.setUTCDate(i.getUTCDate()+e),i},moveMonth:function(t,e){if(!e)return t;var i,n,s=new Date(t.valueOf()),a=s.getUTCDate(),r=s.getUTCMonth(),o=Math.abs(e);if(e=e>0?1:-1,1==o)n=-1==e?function(){return s.getUTCMonth()==r}:function(){return s.getUTCMonth()!=i},i=r+e,s.setUTCMonth(i),(i<0||i>11)&&(i=(i+12)%12);else{for(var l=0;l<o;l++)s=this.moveMonth(s,e);i=s.getUTCMonth(),s.setUTCDate(a),n=function(){return i!=s.getUTCMonth()}}for(;n();)s.setUTCDate(--a),s.setUTCMonth(i);return s},moveYear:function(t,e){return this.moveMonth(t,12*e)},dateWithinRange:function(t){return t>=this.startDate&&t<=this.endDate},keydown:function(t){if(this.picker.is(":not(:visible)"))27==t.keyCode&&this.show();else{var e,i,n,s=!1;switch(t.keyCode){case 27:this.hide(),t.preventDefault();break;case 37:case 39:if(!this.keyboardNavigation)break;e=37==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,e),n=this.moveDate(this.viewDate,e)):1==viewMode?(i=this.moveHour(this.date,e),n=this.moveHour(this.viewDate,e)):0==viewMode&&(i=this.moveMinute(this.date,e),n=this.moveMinute(this.viewDate,e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),s=!0);break;case 38:case 40:if(!this.keyboardNavigation)break;e=38==t.keyCode?-1:1,viewMode=this.viewMode,t.ctrlKey?viewMode+=2:t.shiftKey&&(viewMode+=1),4==viewMode?(i=this.moveYear(this.date,e),n=this.moveYear(this.viewDate,e)):3==viewMode?(i=this.moveMonth(this.date,e),n=this.moveMonth(this.viewDate,e)):2==viewMode?(i=this.moveDate(this.date,7*e),n=this.moveDate(this.viewDate,7*e)):1==viewMode?this.showMeridian?(i=this.moveHour(this.date,6*e),n=this.moveHour(this.viewDate,6*e)):(i=this.moveHour(this.date,4*e),n=this.moveHour(this.viewDate,4*e)):0==viewMode&&(i=this.moveMinute(this.date,4*e),n=this.moveMinute(this.viewDate,4*e)),this.dateWithinRange(i)&&(this.date=i,this.viewDate=n,this.setValue(),this.update(),t.preventDefault(),s=!0);break;case 13:if(0!=this.viewMode){var a=this.viewMode;this.showMode(-1),this.fill(),a==this.viewMode&&this.autoclose&&this.hide()}else this.fill(),this.autoclose&&this.hide();t.preventDefault();break;case 9:this.hide()}if(s){var r;this.isInput?r=this.element:this.component&&(r=this.element.find("input")),r&&r.change(),this.element.trigger({type:"changeDate",date:this.date})}}},showMode:function(t){if(t){var e=Math.max(0,Math.min(a.modes.length-1,this.viewMode+t));e>=this.minView&&e<=this.maxView&&(this.element.trigger({type:"changeMode",date:this.viewDate,oldViewMode:this.viewMode,newViewMode:e}),this.viewMode=e)}this.picker.find(">div").hide().filter(".datetimepicker-"+a.modes[this.viewMode].clsName).css("display","block"),this.updateNavArrows()},reset:function(t){this._setDate(null,"date")},convertViewModeText:function(t){switch(t){case 4:return"decade";case 3:return"year";case 2:return"month";case 1:return"day";case 0:return"hour"}}};var n=t.fn.datetimepicker;t.fn.datetimepicker=function(e){var n=Array.apply(null,arguments);n.shift();var s;return this.each(function(){var a=t(this),r=a.data("datetimepicker"),o="object"==typeof e&&e;if(r||a.data("datetimepicker",r=new i(this,t.extend({},t.fn.datetimepicker.defaults,o))),"string"==typeof e&&"function"==typeof r[e]&&void 0!==(s=r[e].apply(r,n)))return!1}),void 0!==s?s:this},t.fn.datetimepicker.defaults={},t.fn.datetimepicker.Constructor=i;var s=t.fn.datetimepicker.dates={en:{days:["星期日","星期一","星期二","星期三","星期四","星期五","星期六","星期日"],daysShort:["周日","周一","周二","周三","周四","周五","周六","周日"],daysMin:["日","一","二","三","四","五","六","日"],months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],monthsShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],today:"今天",suffix:[],meridiem:["上午","下午"]}},a={modes:[{clsName:"minutes",navFnc:"Hours",navStep:1},{clsName:"hours",navFnc:"Date",navStep:1},{clsName:"days",navFnc:"Month",navStep:1},{clsName:"months",navFnc:"FullYear",navStep:1},{clsName:"years",navFnc:"FullYear",navStep:10}],isLeapYear:function(t){return t%4==0&&t%100!=0||t%400==0},getDaysInMonth:function(t,e){return[31,a.isLeapYear(t)?29:28,31,30,31,30,31,31,30,31,30,31][e]},getDefaultFormat:function(t,e){if("standard"==t)return"input"==e?"yyyy-mm-dd hh:ii":"yyyy-mm-dd hh:ii:ss";if("php"==t)return"input"==e?"Y-m-d H:i":"Y-m-d H:i:s";throw new Error("Invalid format type.")},validParts:function(t){if("standard"==t)return/hh?|HH?|p|P|ii?|ss?|dd?|DD?|mm?|MM?|yy(?:yy)?/g;if("php"==t)return/[dDjlNwzFmMnStyYaABgGhHis]/g;throw new Error("Invalid format type.")},nonpunctuation:/[^ -\/:-@\[-`{-~\t\n\rTZ]+/g,parseFormat:function(t,e){var i=t.replace(this.validParts(e),"\0").split("\0"),n=t.match(this.validParts(e));if(!i||!i.length||!n||0==n.length)throw new Error("Invalid date format.");return{separators:i,parts:n}},parseDate:function(n,a,r,o){if(n instanceof Date){var l=new Date(n.valueOf()-6e4*n.getTimezoneOffset());return l.setMilliseconds(0),l}if(/^\d{4}\-\d{1,2}\-\d{1,2}$/.test(n)&&(a=this.parseFormat("yyyy-mm-dd",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}$/.test(n)&&(a=this.parseFormat("yyyy-mm-dd hh:ii",o)),/^\d{4}\-\d{1,2}\-\d{1,2}[T ]\d{1,2}\:\d{1,2}\:\d{1,2}[Z]{0,1}$/.test(n)&&(a=this.parseFormat("yyyy-mm-dd hh:ii:ss",o)),/^[-+]\d+[dmwy]([\s,]+[-+]\d+[dmwy])*$/.test(n)){var h,d=/([-+]\d+)([dmwy])/,u=n.match(/([-+]\d+)([dmwy])/g);n=new Date;for(b=0;b<u.length;b++)switch(m=d.exec(u[b]),h=parseInt(m[1]),m[2]){case"d":n.setUTCDate(n.getUTCDate()+h);break;case"m":n=i.prototype.moveMonth.call(i.prototype,n,h);break;case"w":n.setUTCDate(n.getUTCDate()+7*h);break;case"y":n=i.prototype.moveYear.call(i.prototype,n,h)}return e(n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate(),n.getUTCHours(),n.getUTCMinutes(),n.getUTCSeconds(),0)}var c,p,m,u=n&&n.toString().match(this.nonpunctuation)||[],n=new Date(0,0,0,0,0,0,0),f={},g=["hh","h","ii","i","ss","s","yyyy","yy","M","MM","m","mm","D","DD","d","dd","H","HH","p","P"],v={hh:function(t,e){return t.setUTCHours(e)},h:function(t,e){return t.setUTCHours(e)},HH:function(t,e){return t.setUTCHours(12==e?0:e)},H:function(t,e){return t.setUTCHours(12==e?0:e)},ii:function(t,e){return t.setUTCMinutes(e)},i:function(t,e){return t.setUTCMinutes(e)},ss:function(t,e){return t.setUTCSeconds(e)},s:function(t,e){return t.setUTCSeconds(e)},yyyy:function(t,e){return t.setUTCFullYear(e)},yy:function(t,e){return t.setUTCFullYear(2e3+e)},m:function(t,e){for(e-=1;e<0;)e+=12;for(e%=12,t.setUTCMonth(e);t.getUTCMonth()!=e;){if(isNaN(t.getUTCMonth()))return t;t.setUTCDate(t.getUTCDate()-1)}return t},d:function(t,e){return t.setUTCDate(e)},p:function(t,e){return t.setUTCHours(1==e?t.getUTCHours()+12:t.getUTCHours())}};if(v.M=v.MM=v.mm=v.m,v.dd=v.d,v.P=v.p,n=e(n.getFullYear(),n.getMonth(),n.getDate(),n.getHours(),n.getMinutes(),n.getSeconds()),u.length==a.parts.length){for(var b=0,w=a.parts.length;b<w;b++){if(c=parseInt(u[b],10),m=a.parts[b],isNaN(c))switch(m){case"MM":p=t(s[r].months).filter(function(){var t=this.slice(0,u[b].length);return t==u[b].slice(0,t.length)}),c=t.inArray(p[0],s[r].months)+1;break;case"M":p=t(s[r].monthsShort).filter(function(){var t=this.slice(0,u[b].length),e=u[b].slice(0,t.length);return t.toLowerCase()==e.toLowerCase()}),c=t.inArray(p[0],s[r].monthsShort)+1;break;case"p":case"P":c=t.inArray(u[b].toLowerCase(),s[r].meridiem)}f[m]=c}for(var y,b=0;b<g.length;b++)(y=g[b])in f&&!isNaN(f[y])&&v[y](n,f[y])}return n},formatDate:function(e,i,n,r){if(null==e)return"";var o;if("standard"==r)o={yy:e.getUTCFullYear().toString().substring(2),yyyy:e.getUTCFullYear(),m:e.getUTCMonth()+1,M:s[n].monthsShort[e.getUTCMonth()],MM:s[n].months[e.getUTCMonth()],d:e.getUTCDate(),D:s[n].daysShort[e.getUTCDay()],DD:s[n].days[e.getUTCDay()],p:2==s[n].meridiem.length?s[n].meridiem[e.getUTCHours()<12?0:1]:"",h:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()},2==s[n].meridiem.length?o.H=o.h%12==0?12:o.h%12:o.H=o.h,o.HH=(o.H<10?"0":"")+o.H,o.P=o.p.toUpperCase(),o.hh=(o.h<10?"0":"")+o.h,o.ii=(o.i<10?"0":"")+o.i,o.ss=(o.s<10?"0":"")+o.s,o.dd=(o.d<10?"0":"")+o.d,o.mm=(o.m<10?"0":"")+o.m;else{if("php"!=r)throw new Error("Invalid format type.");(o={y:e.getUTCFullYear().toString().substring(2),Y:e.getUTCFullYear(),F:s[n].months[e.getUTCMonth()],M:s[n].monthsShort[e.getUTCMonth()],n:e.getUTCMonth()+1,t:a.getDaysInMonth(e.getUTCFullYear(),e.getUTCMonth()),j:e.getUTCDate(),l:s[n].days[e.getUTCDay()],D:s[n].daysShort[e.getUTCDay()],w:e.getUTCDay(),N:0==e.getUTCDay()?7:e.getUTCDay(),S:e.getUTCDate()%10<=s[n].suffix.length?s[n].suffix[e.getUTCDate()%10-1]:"",a:2==s[n].meridiem.length?s[n].meridiem[e.getUTCHours()<12?0:1]:"",g:e.getUTCHours()%12==0?12:e.getUTCHours()%12,G:e.getUTCHours(),i:e.getUTCMinutes(),s:e.getUTCSeconds()}).m=(o.n<10?"0":"")+o.n,o.d=(o.j<10?"0":"")+o.j,o.A=o.a.toString().toUpperCase(),o.h=(o.g<10?"0":"")+o.g,o.H=(o.G<10?"0":"")+o.G,o.i=(o.i<10?"0":"")+o.i,o.s=(o.s<10?"0":"")+o.s}for(var e=[],l=t.extend([],i.separators),h=0,d=i.parts.length;h<d;h++)l.length&&e.push(l.shift()),e.push(o[i.parts[h]]);return l.length&&e.push(l.shift()),e.join("")},convertViewMode:function(t){switch(t){case 4:case"decade":t=4;break;case 3:case"year":t=3;break;case 2:case"month":t=2;break;case 1:case"day":t=1;break;case 0:case"hour":t=0}return t},headTemplate:'<thead><tr><th class="prev"><i class="{leftArrow}"/></th><th colspan="5" class="switch"></th><th class="next"><i class="{rightArrow}"/></th></tr></thead>',headTemplateV3:'<thead><tr><th class="prev"><span class="{iconType} {leftArrow}"></span> </th><th colspan="5" class="switch"></th><th class="next"><span class="{iconType} {rightArrow}"></span> </th></tr></thead>',contTemplate:'<tbody><tr><td colspan="7"></td></tr></tbody>',footTemplate:'<tfoot><tr><th colspan="7" class="today"></th></tr></tfoot>'};a.template='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+a.headTemplate+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplate+a.contTemplate+a.footTemplate+"</table></div></div>",a.templateV3='<div class="datetimepicker"><div class="datetimepicker-minutes"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-hours"><table class=" table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-days"><table class=" table-condensed">'+a.headTemplateV3+"<tbody></tbody>"+a.footTemplate+'</table></div><div class="datetimepicker-months"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+'</table></div><div class="datetimepicker-years"><table class="table-condensed">'+a.headTemplateV3+a.contTemplate+a.footTemplate+"</table></div></div>",t.fn.datetimepicker.DPGlobal=a,t.fn.datetimepicker.noConflict=function(){return t.fn.datetimepicker=n,this},t(document).on("focus.datetimepicker.data-api click.datetimepicker.data-api",'[data-provide="datetimepicker"]',function(e){var i=t(this);i.data("datetimepicker")||(e.preventDefault(),i.datetimepicker("show"))}),t(function(){t('[data-provide="datetimepicker-inline"]').datetimepicker()})}(window.jQuery),function(t,e,i,n){var s=function(t,i){this.$input=t,this.range="";var n={};this.settings=e.extend(!0,{},n,i),this._initialized=!1,this.autoWidth()};s.prototype={$modal:[],$absolute:[],$relative:[],$absoluteStart:[],$absoluteEnd:[],template:'<div class="modal fade"id="datetime-range-picker"><div class="modal-dialog"><div class="modal-content"><div class="modal-header"><h4 class="modal-title">绝对时间</h4></div><div class="modal-body"><div class="datetime-absolute"><input type="text"class="form-control"name="start"value=""/>&nbsp;~&nbsp;<input type="text"class="form-control"name="end"value=""/><br/><button type="button"class="btn btn-default"handle="confirm">确定</button></div></div><div class="modal-header sub-header"><h4 class="modal-title">相对时间</h4></div><div class="modal-body"><ul class="datetime-relative"><li class="btns-month"><button value="本月"class="btn btn-default"type="button">本月</button><button value="上个月"class="btn btn-default"type="button">上个月</button><button value="最近3个月"class="btn btn-default"type="button">最近3个月</button><button value="最近6个月"class="btn btn-default"type="button">最近6个月</button><button value="最近12个月"class="btn btn-default"type="button">最近12个月</button></li><li class="btns-day"><button value="今天"class="btn btn-default"type="button">今天</button><button value="昨天"class="btn btn-default"type="button">昨天</button><button value="最近7天"class="btn btn-default"type="button">最近7天</button><button value="最近15天"class="btn btn-default"type="button">最近15天</button><button value="最近30天"class="btn btn-default"type="button">最近30天</button></li><li class="btns-hour"><button value="最近1小时"class="btn btn-default"type="button">最近1小时</button><button value="最近3小时"class="btn btn-default"type="button">最近3小时</button><button value="最近6小时"class="btn btn-default"type="button">最近6小时</button><button value="最近12小时"class="btn btn-default"type="button">最近12小时</button><button value="最近24小时"class="btn btn-default"type="button">最近24小时</button></li><li class="btns-minute"><button value="最近1分钟"class="btn btn-default"type="button">最近1分钟</button><button value="最近5分钟"class="btn btn-default"type="button">最近5分钟</button><button value="最近10分钟"class="btn btn-default"type="button">最近10分钟</button><button value="最近15分钟"class="btn btn-default"type="button">最近15分钟</button><button value="最近30分钟"class="btn btn-default"type="button">最近30分钟</button></li></ul></div><div class="modal-footer"><button type="button"class="btn btn-default"data-dismiss="modal">关闭</button></div></div></div></div>',format:"YYYY-MM-DD HH:mm:ss",initialize:function(){return this._initialized?this.$input:(this._render()._listen(),this._initialized=!0,this.$input)},autoWidth:function(){this.$input.val().indexOf(" ~ ")>=0?this.$input.css("width","275px"):this.$input.css("width","103px")},_render:function(){this.$modal=e("#datetime-range-picker"),this.$modal.length||(e("body").append(this.template),this.$modal=e("#datetime-range-picker")),this.$absolute=e("#datetime-range-picker .datetime-absolute"),this.$absoluteStart=this.$absolute.find('input[name="start"]'),this.$absoluteEnd=this.$absolute.find('input[name="end"]'),this.$relative=e("#datetime-range-picker .datetime-relative");var t={format:"yyyy-mm-dd hh:ii",endDate:n().format("YYYY-MM-DD")+" 23:59:59",autoclose:!0};return this.$absoluteStart.datetimepicker(t),this.$absoluteEnd.datetimepicker(t),this},_listen:function(){var t=this;return this.$input.click(function(){t._open()}),this.$input.change(function(){t.autoWidth()}),this.$absoluteStart.change(function(){t._whenAbsoluteStartChange()}).bind("show.daterangepicker",function(){e(this).prop("disabled",!0)}).bind("hide.daterangepicker",function(){e(this).prop("disabled",!1)}),this.$absoluteEnd.change(function(){t._whenAbsoluteEndChange()}).bind("show.daterangepicker",function(){e(this).prop("disabled",!0)}).bind("hide.daterangepicker",function(){e(this).prop("disabled",!1)}),this.$absolute.on("click",'[handle="confirm"]',function(e){t._pickup("absolute")}),this.$relative.on("click","button",function(i){t._pickup("relative",e(i.target).text())}),this.$modal.on("hidden.bs.modal",function(){t._close()}),this},_open:function(){if(this.$modal.modal("show"),this.$input.prop("disabled",!0),this.range=this.$input.val(),e.isRelativeDateTimeRange(this.range))e('button[value="'+this.range+'"]').addClass("active");else{var t=this.range.split(" ~ ");this.$absolute.find('input[name="start"]').val(t[0]),this.$absolute.find('input[name="end"]').val(t[1])}this._validateAbsoluteValue()},_whenAbsoluteStartChange:function(){var t=this.$absoluteStart.val(),e=this.$absoluteEnd.val();this.$absoluteEnd.data("datetimepicker").setStartDate(t+":59"),n(t).unix()>=n(e).unix()&&this.$absoluteEnd.val("").trigger("change"),this._validateAbsoluteValue()},_whenAbsoluteEndChange:function(){this._validateAbsoluteValue()},_validateAbsoluteValue:function(){var t=!(this.$absoluteStart.val()&&this.$absoluteEnd.val());return this.$absolute.find('[handle="confirm"]').prop("disabled",!!t),t},_pickup:function(t,e){var i="";"absolute"==t?i=this.$absoluteStart.val()+" ~ "+this.$absoluteEnd.val():"relative"==t&&(i=e),this.$input.val(i).trigger("change"),this.$modal.modal("hide")},_close:function(){this.$input.prop("disabled",!1),this.$absolute.find("input:text").val(""),e(".btn-default",this.$relative).removeClass("active")}},e.fn.datetimeRangePicker=function(t){return new s(this,t).initialize()}}(window,$,_,moment),function(t,e,i){var n=function(t,e){this.$wrap=[],this.$element=[],this.$fields=[],this.settings={},this.checked=[],this.enabled=!1,this.initialize(t,e)};n.prototype={defaults:{fields:[],localStorageKey:"DFP"},wrap:'<div class="unit-display-fields-picker"></div>',tooltip:'<div class="tooltip left hide"><div class="tooltip-arrow"></div><div class="tooltip-inner"><ul class="fields-list"></ul></div></div>',templateOfFields:'<%_.each(fields,function(field,index){%><li><label class="label-checkbox"><input type="checkbox"name="__fields__"value="<%= field %>"<%if(_.indexOf(checked,field)>=0){%>checked<%}%>/><span class="input-replacement"></span><span class="input-name">&nbsp;&nbsp;<%=field%></span></label></li><%})%>',initialize:function(t,n){if(this.enabled)return this;this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),n),this.enabled=!0;var s=this._fromLocalStorage();return this.checked=s.length?s:i.first(this.settings.fields,5),this._render()._listen(),this.$element},getChecked:function(){return this.checked},_render:function(){this.$element.wrap(this.wrap),this.$wrap=this.$element.parent(),this.$wrap.append(this.tooltip),this.$fields=this.$wrap.find(".fields-list");var t=i.template(this.templateOfFields)({fields:this.settings.fields,checked:this.checked});return this.$fields.html(t),this},_listen:function(){var t=this;e('[name="__fields__"]').change(function(){t.checked=[],e('[name="__fields__"]').each(function(){e(this).prop("checked")&&t.checked.push(e(this).val())}),t._toLocalStorage(),t.$element.trigger("displayFieldsPicker.change")}),this.$element.click(function(){e(this).siblings(".tooltip").removeClass("hide")}),e(".tooltip",this.$wrap).mouseleave(function(){e(this).addClass("hide")})},_toLocalStorage:function(){t.localStorage.setItem(this.settings.localStorageKey,JSON.stringify(this.checked))},_fromLocalStorage:function(){var e=t.localStorage.getItem(this.settings.localStorageKey);return e?JSON.parse(e):[]}},e.fn.displayFieldsPicker=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.displayFieldsPicker");if("BUTTON"==e(this)[0].tagName){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.displayFieldsPicker",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t,e){var i=function(t,e){this.$wrap=[],this.$element=[],this.settings={},this.enabled=!1,this.initialize(t,e)};i.prototype={defaults:{options:[{text:"请选择",value:""}]},wrapTemplate:'<div class="btn-group"></div>',template:'<button class="btn btn-default dropdown-toggle"data-toggle="dropdown"type="button"><span class="text">请选择</span>&nbsp;<span class="caret font-gray"></span></button><ul class="dropdown-menu"><li value="" text="选项1"><a href="javascript:void(0)">请选择</a></li></ul>',initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this._render()._listen())},setDisabled:function(t){for(var i=0;i<t.length;i++)e('.dropdown-menu li[value="'+t[i]+'"]',this.$wrap).addClass("disabled")},updateOptions:function(t){return this.settings.options=t,this._renderOptions(),this.$element.trigger("pick.dropdownSelector"),this},_render:function(){return this.$element.wrap(this.wrapTemplate),this.$wrap=this.$element.parent(),this.$wrap.prepend(this.template),this._renderOptions(),this},_renderOptions:function(){for(var t=this.settings.options,e="",i=0;i<t.length;i++){var n=t[i];"string"==typeof n?e+='<li value="'+n+'" text="'+n+'"><a href="javascript:void(0)">'+n+"</a></li>":n.divider?e+='<li class="divider"></li>':e+='<li class="'+(n.disabled?"disabled":"")+'" value="'+n.value+'" text="'+n.text+'" default="'+(n.default?"true":"false")+'"><a href="javascript:void(0)">'+n.text+"</a></li>"}return this.$wrap.find(".dropdown-menu").html(e),this},_listen:function(){var t=this;return this.$element.change(function(){e(this).trigger("pick.dropdownSelector")}),this.$element.bind("pick.dropdownSelector",function(){t._pick()}).trigger("pick.dropdownSelector"),this.$wrap.on("click",".dropdown-menu li",function(){var i=e(this);i.hasClass("disabled")||i.hasClass("active")||t.$element.val(i.attr("value")).trigger("change")}),this},_pick:function(){var t=this.$element.val(),i=e('.dropdown-menu li[value="'+t+'"]',this.$wrap);if(!i.length){var n=e('.dropdown-menu li[default="true"]',this.$wrap);return n.length||(n=e(".dropdown-menu li:first",this.$wrap)),this.$element.val(n.attr("value")).trigger("change"),this}return e(".dropdown-toggle .text",this.$wrap).text(i.attr("text")),i.addClass("active").siblings().removeClass("active"),this}},e.fn.dropdownSelector=function(t,n){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("obj.dropdownSelector");if("INPUT"==e(this)[0].tagName&&"hidden"==e(this)[0].type){if(!r){if("destroy"==t)return;r=new i(s,a),s.data("obj.dropdownSelector",r)}"string"==typeof t&&r[t](n)}})}}(window,$),function(t,e,i){var n=function(t,e){this.$element=[],this.settings={},this.enabled=!1,this.echart={},this.builder={},this.initialize(t,e)};n.prototype={defaults:{format:"line",url:"",theme:"dark",loadingStart:function(){},loadingDone:function(){},$scopeRange:[]},initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this._render())},destroy:function(){this.$element.empty(),this.$element.data("instance.esChart","")},setUrl:function(t){return this.settings.url=t,this},refresh:function(t){if(!this.settings.url)return this;var i=this;return"function"==typeof this.settings.loadingStart&&this.settings.loadingStart(),e.http.get(this.settings.url,{},{success:function(e){t?i.echart.clearThenDraw(e):i.echart.draw(e),i.settings.$scopeRange.length&&i.settings.$scopeRange.text(e.scope.range)},error:function(t,i,n){e.message.warn(n)},complete:function(){"function"==typeof i.settings.loadingDone&&i.settings.loadingDone()}}),this},resize:function(){this.echart.instance.resize()},_render:function(){var t=this.$element[0],e=this.settings.theme;switch(this.settings.format){case"line":this.echart=new s(t,e);break;case"bar":this.echart=new a(t,e);break;case"pie":this.echart=new r(t,e);break;case"panel":this.echart=new o(t,e);break;case"radar":this.echart=new l(t,e);break;case"table":this.echart=new h(t,e)}return this.refresh()}};var s=function(t,e){return this.instance={},this.option={},this._initialized=!1,this.initialize(t,e).draw({x:[],lines:[]})};s.prototype={_defaultOption:{title:{text:"折线图示例",show:!1},tooltip:{trigger:"axis"},legend:{data:[],bottom:0},grid:{left:"12px",right:"12px",bottom:"11%",top:"12px",containLabel:!0},xAxis:{type:"category",data:[]},yAxis:{type:"value",axisLabel:{}},series:[]},initialize:function(t,e){return this._initialized?this:(this.instance=echarts.init(t,e),this._initialized=!0,this)},clearThenDraw:function(t){return this.instance.clear(),this.draw(t),this},draw:function(t){return this._setOption(t),this.instance.setOption(this.option),this},_setOption:function(t){this.option=e.extend(!0,{},this._defaultOption),this.option.yAxis.axisLabel.formatter=this._axisLabelFormatter,this.option.xAxis.data=t.x;for(var i=0;i<t.lines.length;i++){var n=t.lines[i];this.option.series.push({name:n.name,type:"line",data:n.value}),this.option.legend.data.push(n.name)}return this},_axisLabelFormatter:function(t,e){return t>=1e8?t=t/1e8+"亿":t>=1e4&&(t=t/1e4+"万"),t}};var a=function(t,e){return this.instance={},this.option={},this._initialized=!1,this.initialize(t,e).draw({x:[],bar:null})};a.prototype={_defaultOption:{title:{text:"条形图示例",show:!1},tooltip:{},legend:{data:[],bottom:0,show:!1},grid:{left:"12px",right:"12px",bottom:"11%",top:"12px",containLabel:!0},xAxis:{type:"category",boundaryGap:!0,axisLabel:{interval:0,rotate:-45,margin:10},data:[]},yAxis:{type:"value",axisLabel:{}},series:[]},initialize:function(t,e){return this._initialized?this:(this.instance=echarts.init(t,e),this._initialized=!0,this)},clearThenDraw:function(t){return this.instance.clear(),this.draw(t),this},draw:function(t){return this._setOption(t),this.instance.setOption(this.option),this},_setOption:function(t){return this.option=e.extend(!0,{},this._defaultOption),this.option.yAxis.axisLabel.formatter=this._axisLabelFormatter,this.option.xAxis.data=t.x,t.bar&&(this.option.series.push({name:t.bar.name,data:t.bar.value,type:"bar",barWidth:"60%"}),this.option.legend.data.push(t.bar.name)),this},_axisLabelFormatter:function(t,e){return t>=1e8?t=t/1e8+"亿":t>=1e4&&(t=t/1e4+"万"),t}};var r=function(t,e){return this.instance={},this.option={},this._initialized=!1,this.initialize(t,e).draw({x:[],pie:null})};r.prototype={_defaultOption:{title:{text:"饼状图示例",show:!1},tooltip:{trigger:"item",formatter:"{a} <br/>{b} : {c} ({d}%)"},legend:{orient:"horizontal",bottom:0,data:[]},series:[]},initialize:function(t,e){return this._initialized?this:(this.instance=echarts.init(t,e),this._initialized=!0,this)},clearThenDraw:function(t){return this.instance.clear(),this.draw(t),this},draw:function(t){return this._setOption(t),this.instance.setOption(this.option),this},_setOption:function(t){if(this.option=e.extend(!0,{},this._defaultOption),t.pie){for(var i=[],n=0;n<t.pie.value.length;n++)i.push({value:t.pie.value[n],name:t.x[n]});this.option.series.push({name:t.pie.name,data:i,type:"pie",radius:["20%","70%"],center:["50%","50%"],itemStyle:{emphasis:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}})}return this},_axisLabelFormatter:function(t,e){return t>=1e8?t=t/1e8+"亿":t>=1e4&&(t=t/1e4+"万"),t}};var o=function(t,e){return this.instance={},this.option={},this._initialized=!1,this.initialize(t,e).draw({})};o.prototype={_defaultOption:{title:{text:"仪表盘示例",show:!1},tooltip:{formatter:"{b} : {c}"},series:[{type:"gauge",axisLabel:{},axisTick:{lineStyle:{color:"auto"}},splitLine:{length:14,lineStyle:{color:"auto"}},radius:"100%",center:["50%","57%"],axisLine:{lineStyle:{width:10,color:[[.2,"#1aa844"],[.8,"#0098d9"],[1,"#ff715e"]]}},title:{offsetCenter:[0,"30%"],color:"#ddd"},detail:{offsetCenter:[0,"50%"],textStyle:{fontSize:16}},data:[{value:0}]}]},initialize:function(t,e){return this._initialized?this:(this.instance=echarts.init(t,e),this._setOption({}),this._initialized=!0,this)},clearThenDraw:function(t){return this.instance.clear(),this._setOption({}),this.draw(t),this},draw:function(t){return this._setOptionAboutPanel(t),this.instance.setOption(this.option),this},_setOption:function(t){return this.option=e.extend(!0,{},this._defaultOption),this.option.series[0].axisLabel.formatter=this._axisLabelFormatter,this.option.series[0].detail.formatter=this._detailFormatter,this._setOptionAboutPanel(t)},_setOptionAboutPanel:function(t){return t.min&&(this.option.series[0].min=t.min),t.max&&(this.option.series[0].max=t.max),this.option.series[0].data[0].value=t.value||0,this.option.series[0].data[0].name=t.name||0,this},_axisLabelFormatter:function(t,e){return t>=1e8?t=t/1e8+"亿":t>=1e4&&(t=t/1e4+"万"),t},_detailFormatter:function(t,e){return t>=1e8?t=(t/1e8).toFixed(2)+"亿":t>=1e4?t=(t/1e4).toFixed(2)+"万":(""+t).length>=8&&(t=t.toFixed(4)),t}};var l=function(t,e){return this.instance={},this.option={},this._initialized=!1,this.initialize(t,e).draw({indicators:[]})};l.prototype={_defaultOption:{title:{text:"雷达图示例",show:!1},tooltip:{trigger:"axis"},radar:{shape:"circle",indicator:[{name:"-",max:100}],splitArea:{show:!1},splitLine:{lineStyle:{color:["#333","#444","#555","#666","#777","#888","#999"]}},axisLine:{lineStyle:{color:"#999"}}},series:[{type:"radar",tooltip:{trigger:"item"},itemStyle:{normal:{areaStyle:{type:"default"}}},data:[{value:[0]}]}]},initialize:function(t,e){return this._initialized?this:(this.instance=echarts.init(t,e),this._initialized=!0,this)},clearThenDraw:function(t){return this.instance.clear(),this.draw(t),this},draw:function(t){return this._setOption(t),this.instance.setOption(this.option),this},_setOption:function(t){this.option=e.extend(!0,{},this._defaultOption);for(var i=[],n=[],s=0;s<t.indicators.length;s++){var a=t.indicators[s];i.push({name:a.name,max:Math.max(a.max,a.value)}),n.push(a.value)}return t.indicators.length&&(this.option.radar.indicator=i,this.option.series[0].data[0].value=n),this}};var h=function(t,e){return this.$element=[],this.instance=this,this._initialized=!1,this.initialize(t,e)};h.prototype={_defaultOption:{},template:'<table class="table-chart"width="100%"><tr><th><%=table.row[0].field%>&nbsp;\\&nbsp;<%=table.col[0].field%></th><%_.each(table.col,function(col,c){%><th><%=col.value%><i>&nbsp;(<%=col.operator.split("_")[1]%>)</i></th><%})%></tr><%_.each(table.row,function(row,r){%><tr><%_.each(table.col,function(col,c){%><%if(!c){%><th><%=row.value%><i>&nbsp;(<%=row.operator.split("_")[1]%>)</i></th><%}%><td><%=value[r+"-"+c]%></td><%})%></tr><%})%></table>',initialize:function(t,i){return this._initialized?this:(this.$element=e(t),this.$element.addClass("table-chart-"+i),this._initialized=!0,this)},clearThenDraw:function(t){return this.draw(t)},draw:function(t){if(!t)return this._showBlank();var e=i.template(this.template)(t);return this.$element.html(e),this},_showBlank:function(){return this.$element.find("td").text(""),this},resize:function(){}},e.fn.esChart=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.esChart");if("DIV"==e(this)[0].tagName){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.esChart",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t,e,i){var n=function(t,e){this.$builder=[],this.$element=[],this.settings={},this.enabled=!1,this.model={},this.builder={},this.initialize(t,e)};n.prototype={defaults:{format:"line",mapping:{}},form:'<form class="form-horizontal unit-form es-chart-builder"></form>',initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this.model=this.$element.val()?JSON.parse(this.$element.val()):{},this._render())},destroy:function(){this.$builder.empty().remove(),this.$element.data("instance.esChartBuilder","")},validate:function(){var t=0;if(e("input:text",this.$builder).each(function(){e(this).val()||1==++t&&e(this).focus()}),t&&e.message.warn("有"+t+"项为空, 请按提示填写"),"table"==this.settings.format){if(!e('input[name="table.col"]',this.$builder).esFilter().val().length)return e.message.warn("表格至少定义一列"),!1;if(!e('input[name="table.row"]',this.$builder).esFilter().val().length)return e.message.warn("表格至少定义一行"),!1}return!t},getValue:function(){return this.builder.getValue()},toString:function(){this.$element.val(JSON.stringify(this.getValue()))},_render:function(){switch(this.$element.after(this.form),this.$builder=this.$element.siblings("form.es-chart-builder"),s.mapping=this.settings.mapping,this.settings.format){case"line":this.builder=new a(this.model,this.$builder);break;case"bar":this.builder=new r(this.model,this.$builder);break;case"pie":this.builder=new o(this.model,this.$builder);break;case"panel":this.builder=new l(this.model,this.$builder);break;case"radar":this.builder=new h(this.model,this.$builder);break;case"table":this.builder=new d(this.model,this.$builder)}return this}};var s={mapping:{},methods:{count:{text:"计数",types:[]},sum:{text:"求和",types:["numeric"]},avg:{text:"平均",types:["numeric"]},max:{text:"最大值",types:["numeric"]},min:{text:"最小值",types:["numeric"]}},intervals:[{value:"1M",seconds:2592e3,text:"月",default:!0},{value:"1w",seconds:604800,text:"周",default:!0},{value:"1d",seconds:86400,text:"天",default:!0},{value:"12h",seconds:43200,text:"12小时"},{value:"6h",seconds:21600,text:"6小时"},{value:"1h",seconds:3600,text:"小时",default:!0},{value:"30m",seconds:1800,text:"30分钟"},{value:"15m",seconds:900,text:"15分钟"},{value:"10m",seconds:600,text:"10分钟"},{value:"5m",seconds:300,text:"5分钟"},{value:"1m",seconds:60,text:"分钟",default:!0},{value:"30s",seconds:30,text:"30秒钟"},{value:"15s",seconds:15,text:"15秒钟"},{value:"10s",seconds:10,text:"10秒钟"},{value:"5s",seconds:5,text:"5秒钟"},{value:"1s",seconds:1,text:"秒钟",default:!0}],getFieldType:function(t){return this.mapping[t]},getFieldsByTypes:function(t){var i=[];for(var n in this.mapping)e.inArray(this.mapping[n],t)>=0&&i.push(n);return i},getMethodOptions:function(){var t=[];for(var e in this.methods)t.push({text:this.methods[e].text,value:e});return t},getMethodOptionsForPie:function(){return[{text:"计数",value:"count"},{text:"求和",value:"sum"}]},getMethodTypes:function(t){return this.methods[t].types},getIntervalOptions:function(t){for(var i=(t=e.isRelativeDateTimeRange(t)?e.parseRelativeDateTimeRange(t):t).split(" ~ "),n=moment(i[0]).unix(),a=moment(i[1]).unix()-n,r=[],o=0;o<s.intervals.length;o++){var l=s.intervals[o];a/l.seconds>=2&&a/l.seconds<=240&&r.push(e.extend(!0,{},l))}return r}},a=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};a.prototype={name:"折线图",template:"lineBuilder",templateOfLine:"lineBuilder-newLine",default:{scope:{field:"",range:"最近1小时",interval:"1m"},lines:[{name:"日志总量",method:"count",field:"",filters:[]}]},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),interval:e('input[name="scope.interval"]',this.$builder).val()},lines:this._getLines()}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);this.$builder.empty().html(t),this._renderScope(),this._deleteBtnShowOrHide();var i=this;return e(".line-item",this.$builder).each(function(){i._renderLine(e(this))}),this},_renderScope:function(){e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.interval"]',this.$builder).dropdownSelector({options:s.getIntervalOptions(this.model.scope.range)})},_renderLine:function(t){var i=e('input[name="line.name"]',t),n=e('input[name="line.method"]',t),a=e('input[name="line.filters"]',t),r=e('input[name="line.field"]',t);return i.tooltip({container:"body"}),n.dropdownSelector({options:s.getMethodOptions()}),r.dropdownSelector(),a.esFilter({mapping:s.mapping}),this._updateFieldOptionsByMethod(n),this},_listen:function(){var t=this;return this.$builder.on("change",'input[name="scope.range"]',function(i){t._rangeChange(e(i.target).val())}),this.$builder.on("click",'[handle="createLine"]',function(){t._createLine()}),this.$builder.on("click",'[handle="deleteLine"]',function(i){t._deleteLine(e(i.target).closest(".line-item"))}),this.$builder.on("change",'[name="line.method"]',function(i){t._updateFieldOptionsByMethod(e(i.target))}),this},_rangeChange:function(t){var i=s.getIntervalOptions(t);e('input[name="scope.interval"]',this.$builder).dropdownSelector("updateOptions",i)},_createLine:function(){var t=e.renderFormTpl("chart","lineBuilder-newLine",{}),i=e(".line-list",this.$builder);return i.append(t),this._renderLine(i.children(".line-item:last")),this._deleteBtnShowOrHide()},_deleteLine:function(t){return e("input:text",t).tooltip("destroy"),t.remove(),this._deleteBtnShowOrHide()},_deleteBtnShowOrHide:function(){var t=e('[handle="deleteLine"]',this.$builder);return t.length<=1?t.hide():t.show(),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".line-item").find('[name="line.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this},_getLines:function(){var t=[];return e(".line-item",this.$builder).each(function(){t.push({name:e('input[name="line.name"]',e(this)).val(),method:e('input[name="line.method"]',e(this)).val(),field:e('input[name="line.field"]',e(this)).val(),filters:e('input[name="line.filters"]',e(this)).esFilter().val()})}),t}};var r=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};r.prototype={name:"柱状图",template:"barBuilder",default:{scope:{field:"",range:"最近1小时",filters:[]},statistic:{method:"count",field:""},category:{field:"fromhost",bucketing:"Top 20",ranges:[]}},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),filters:e('input[name="scope.filters"]',this.$builder).esFilter().val()},statistic:{method:e('input[name="statistic.method"]',this.$builder).val(),field:e('input[name="statistic.field"]',this.$builder).val()},category:{field:e('input[name="category.field"]',this.$builder).val(),bucketing:e('input[name="category.bucketing"]',this.$builder).val(),ranges:JSON.parse(e('input[name="category.ranges"]',this.$builder).esTermRanges("toString").val())}}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);return this.$builder.empty().html(t),e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.filters"]',this.$builder).esFilter({mapping:s.mapping}),e('input[name="statistic.method"]',this.$builder).dropdownSelector({options:s.getMethodOptions()}),e('input[name="statistic.field"]',this.$builder).dropdownSelector(),e('input[name="category.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["string","numeric"])}),e('input[name="category.bucketing"]',this.$builder).dropdownSelector(),e(".glyphicon-info-sign").tooltip({container:"body"}),this},_listen:function(){var t=this;return e('[name="statistic.method"]',this.$builder).change(function(){t._updateFieldOptionsByMethod(e(this))}).trigger("change"),e('[name="category.field"]',this.$builder).change(function(){t._updateBucketingOptionsByField(e(this))}).trigger("change"),e('[name="category.bucketing"]',this.$builder).change(function(){t._updateCategoryRangesByBucketing(e(this))}).trigger("change"),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".form-group").find('[name="statistic.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this},_updateBucketingOptionsByField:function(t){var i=s.getFieldType(t.val()),n=[{text:"Top 10",value:"Top 10"},{text:"Top 20",value:"Top 20"},{divider:!0},{text:"Bottom 10",value:"Bottom 10"},{text:"Bottom 20",value:"Bottom 20"}];return"numeric"==i?(n.push({divider:!0}),n.push({text:"自定义分类",value:"Numeric ranges"})):"date"==i&&(n.push({divider:!0}),n.push({text:"自定义分类",value:"Date ranges"})),e('[name="category.bucketing"]',this.$builder).dropdownSelector("updateOptions",n),this},_updateCategoryRangesByBucketing:function(t){var i=e('[name="category.ranges"]',this.$builder),n=t.val();i.esTermRanges("destroy"),n.indexOf("ranges")>0?(i.esTermRanges(),i.closest(".form-group").show()):i.closest(".form-group").hide()}};var o=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};o.prototype={name:"饼装图",template:"pieBuilder",default:{scope:{field:"",range:"最近1小时",filters:[]},statistic:{method:"count",field:""},category:{field:"fromhost",bucketing:"Top 20",ranges:[]}},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),filters:e('input[name="scope.filters"]',this.$builder).esFilter().val()},statistic:{method:e('input[name="statistic.method"]',this.$builder).val(),field:e('input[name="statistic.field"]',this.$builder).val()},category:{field:e('input[name="category.field"]',this.$builder).val(),bucketing:e('input[name="category.bucketing"]',this.$builder).val(),ranges:JSON.parse(e('input[name="category.ranges"]',this.$builder).esTermRanges("toString").val())}}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);return this.$builder.empty().html(t),e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.filters"]',this.$builder).esFilter({mapping:s.mapping}),e('input[name="statistic.method"]',this.$builder).dropdownSelector({options:s.getMethodOptions()}),e('input[name="statistic.field"]',this.$builder).dropdownSelector(),e('input[name="category.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["string","numeric"])}),e('input[name="category.bucketing"]',this.$builder).dropdownSelector(),e(".glyphicon-info-sign").tooltip({container:"body"}),this},_listen:function(){var t=this;return e('[name="statistic.method"]',this.$builder).change(function(){t._updateFieldOptionsByMethod(e(this))}).trigger("change"),e('[name="category.field"]',this.$builder).change(function(){t._updateBucketingOptionsByField(e(this))}).trigger("change"),e('[name="category.bucketing"]',this.$builder).change(function(){t._updateCategoryRangesByBucketing(e(this))}).trigger("change"),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".form-group").find('[name="statistic.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this},_updateBucketingOptionsByField:function(t){var i=s.getFieldType(t.val()),n=[{text:"Top 10",value:"Top 10"},{text:"Top 20",value:"Top 20"},{divider:!0},{text:"Bottom 10",value:"Bottom 10"},{text:"Bottom 20",value:"Bottom 20"}];return"numeric"==i?(n.push({divider:!0}),n.push({text:"自定义分类",value:"Numeric ranges"})):"date"==i&&(n.push({divider:!0}),n.push({text:"自定义分类",value:"Date ranges"})),e('[name="category.bucketing"]',this.$builder).dropdownSelector("updateOptions",n),this},_updateCategoryRangesByBucketing:function(t){var i=e('[name="category.ranges"]',this.$builder),n=t.val();i.esTermRanges("destroy"),n.indexOf("ranges")>0?(i.esTermRanges(),i.closest(".form-group").show()):i.closest(".form-group").hide()}};var l=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};l.prototype={name:"饼装图",template:"panelBuilder",default:{scope:{field:"",range:"最近1小时",filters:[]},statistic:{method:"count",field:""},panel:{min:0,max:5e8}},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),filters:e('input[name="scope.filters"]',this.$builder).esFilter().val()},statistic:{method:e('input[name="statistic.method"]',this.$builder).val(),field:e('input[name="statistic.field"]',this.$builder).val()},panel:{min:e('input[name="panel.min"]',this.$builder).val(),max:e('input[name="panel.max"]',this.$builder).val()}}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);return this.$builder.empty().html(t),e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.filters"]',this.$builder).esFilter({mapping:s.mapping}),e('input[name="statistic.method"]',this.$builder).dropdownSelector({options:s.getMethodOptions()}),e('input[name="statistic.field"]',this.$builder).dropdownSelector(),this},_listen:function(){var t=this;return e('[name="statistic.method"]',this.$builder).change(function(){t._updateFieldOptionsByMethod(e(this))}).trigger("change"),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".form-group").find('[name="statistic.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this}};var h=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};h.prototype={name:"雷达图",template:"radarBuilder",templateOfIndicator:"radarBuilder-newIndicator",default:{scope:{field:"",range:"最近1小时",filters:[]},indicators:[{name:"",method:"count",field:"",max:""},{name:"",method:"count",field:"",max:""},{name:"",method:"count",field:"",max:""}]},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),filters:e('input[name="scope.filters"]',this.$builder).esFilter().val()},indicators:this._getIndicators()}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);this.$builder.empty().html(t),this._renderScope(),this._deleteBtnShowOrHide();var i=this;return e(".indicator-item",this.$builder).each(function(){i._renderIndicator(e(this))}),this},_renderScope:function(){e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.filters"]',this.$builder).esFilter({mapping:s.mapping})},_renderIndicator:function(t){var i=e('input[name="indicator.name"]',t),n=e('input[name="indicator.method"]',t),a=e('input[name="indicator.field"]',t);return i.tooltip({container:"body"}),n.dropdownSelector({options:s.getMethodOptions()}),a.dropdownSelector(),this._updateFieldOptionsByMethod(n),this},_listen:function(){var t=this;return this.$builder.on("click",'[handle="createIndicator"]',function(){t._createIndicator()}),this.$builder.on("click",'[handle="deleteIndicator"]',function(){t._deleteIndicator(e(this).closest(".indicator-item"))}),this.$builder.on("change",'[name="indicator.method"]',function(){t._updateFieldOptionsByMethod(e(this))}),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".form-group").find('[name="indicator.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this},_deleteBtnShowOrHide:function(){var t=e('[handle="deleteIndicator"]',this.$builder);return t.length<=3?t.hide():t.show(),this},_createIndicator:function(){var t=e.renderFormTpl("chart",this.templateOfIndicator,{}),i=e(".indicator-list",this.$builder);return i.append(t),this._renderIndicator(i.find(".indicator-item:last")),this._deleteBtnShowOrHide()},_deleteIndicator:function(t){return e("input:text",t).tooltip("destroy"),t.remove(),this._deleteBtnShowOrHide()},_getIndicators:function(){var t=[];return e(".indicator-item",this.$builder).each(function(){t.push({name:e('input[name="indicator.name"]',e(this)).val(),method:e('input[name="indicator.method"]',e(this)).val(),field:e('input[name="indicator.field"]',e(this)).val(),max:e('input[name="indicator.max"]',e(this)).val()})}),t}};var d=function(t,e){this.$builder=[],this.model={},this.enabled=!1,this.initialize(t,e)};d.prototype={name:"表格",template:"tableBuilder",default:{scope:{field:"",range:"最近1小时",filters:[]},statistic:{method:"count",field:""},table:{col:[],row:[]}},initialize:function(t,i){return this.enabled?this:(this.$builder=i,this.model=e.extend(!0,{},this.default,t),this.enabled=!0,this._render()._listen())},getValue:function(){return{scope:{field:e('input[name="scope.field"]',this.$builder).val(),range:e('input[name="scope.range"]',this.$builder).val(),filters:e('input[name="scope.filters"]',this.$builder).esFilter().val()},statistic:{method:e('input[name="statistic.method"]',this.$builder).val(),field:e('input[name="statistic.field"]',this.$builder).val()},table:{col:e('input[name="table.col"]',this.$builder).esFilter().val(),row:e('input[name="table.row"]',this.$builder).esFilter().val()}}},_render:function(){var t=e.renderFormTpl("chart",this.template,this.model);return this.$builder.empty().html(t),e('input[name="scope.field"]',this.$builder).dropdownSelector({options:s.getFieldsByTypes(["date"])}),e('input[name="scope.range"]',this.$builder).datetimeRangePicker(),e('input[name="scope.filters"]',this.$builder).esFilter({mapping:s.mapping}),e('input[name="statistic.method"]',this.$builder).dropdownSelector({options:s.getMethodOptions()}),e('input[name="statistic.field"]',this.$builder).dropdownSelector(),e('input[name="table.col"]',this.$builder).esFilter({mapping:s.mapping}),e('input[name="table.row"]',this.$builder).esFilter({mapping:s.mapping}),this},_listen:function(){var t=this;return e('[name="statistic.method"]',this.$builder).change(function(){t._updateFieldOptionsByMethod(e(this))}).trigger("change"),e('[name="table.col"], [name="table.row"]',this.$builder).bind("esFilter.create",function(){var t=e(this).siblings(".es-filter"),i=e(".filter-item:first",t),n=e(".filter-item:last",t);n.is(i)||(e("[name=field]",n).val(e("[name=field]",i).val()).trigger("change"),e("[name=field]",i.siblings()).siblings("button").prop("disabled",!0))}).bind("esFilter.delete",function(){var t=e(this).siblings(".es-filter"),i=e(".filter-item:first",t);e("[name=field]",i).siblings("button").prop("disabled",!1)}).trigger("esFilter.create"),this.$builder.on("change",'.filter-item [name="field"]',function(){var t=e(this).closest(".es-filter"),i=e(".filter-item:first",t);e("[name=field]",i).is(e(this))&&i.siblings().remove()}),this},_updateFieldOptionsByMethod:function(t){var e=t.closest(".form-group").find('[name="statistic.field"]'),i=s.getMethodTypes(t.val());return i.length?(e.dropdownSelector("updateOptions",s.getFieldsByTypes(i)),e.closest(".btn-group").show()):(e.val(""),e.closest(".btn-group").hide()),this}},e.fn.esChartBuilder=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.esChartBuilder");if("INPUT"==e(this)[0].tagName){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.esChartBuilder",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t,e){var i=function(t,i){this.$input=t,this.$filters=[],this.$createBtn=[];var n={mapping:{}};this.settings=e.extend(!0,{},n,i),this._initialized=!1};i.prototype={template:'<ul class="es-filter"></ul><button class="btn btn-default"type="button"handle="create"title="添加"><i class="glyphicon glyphicon-plus text-primary"></i></button>',itemTemplate:'<li class="filter-item"><input type="hidden"name="field"format=""value=""/>&nbsp;<input type="hidden"name="operator"value=""/>&nbsp;<span class="filter-value"><input class="form-control"type="text"name="value"format=""value=""title=""/><i class="glyphicon glyphicon-minus-sign delete-filter"handle="delete"title="删除"></i></span></li>',fields:[],operatorMap:{date:[{text:"at",value:"date_at"},{text:"range",value:"date_range"}],string:[{text:"=",value:"string_="},{text:"!=",value:"string_!="},{text:"like",value:"string_like"},{text:"match",value:"string_match"},{text:"in",value:"string_in"}],numeric:[{text:"=",value:"numeric_="},{text:"!=",value:"numeric_!="},{text:">=",value:"numeric_>="},{text:"<=",value:"numeric_<="},{text:">",value:"numeric_>"},{text:"<",value:"numeric_<"},{text:"in",value:"numeric_in"},{text:"range",value:"numeric_range"}]},valueMap:{date_at:{tooltip:"某个时间, 如: 2017-05 或 2017-05-01 或 2017-05-01 08 或 2017-05-01 08:30 或 2017-05-01 08:30:10"},date_range:{tooltip:"在某个时间范围中, 如: 2017-05-01 08:30 ~ 2017-05-02 08:30"},"string_=":{tooltip:"完全匹配"},"string_!=":{tooltip:"完全不匹配"},string_like:{tooltip:'通配符匹配, "?"代表某一个字符, "*"代表任意多个字符'},string_match:{tooltip:"正则匹配, 如: .*\\.ffan\\.com"},string_in:{tooltip:"完全匹配其一, 多个逗号分割, 格式如: a,b,c"},"numeric_=":{tooltip:"数字"},"numeric_!=":{tooltip:"数字"},"numeric_>=":{tooltip:"数字"},"numeric_<=":{tooltip:"数字"},"numeric_>":{tooltip:"数字"},"numeric_<":{tooltip:"数字"},numeric_in:{tooltip:"等于其一, 多个逗号分割, 格式如: 1,2,3"},numeric_range:{tooltip:"在某个范围中, 格式如: 10~100"}},initialize:function(){return this._initialized?this:(this.fields=this._getFields(),this._render()._listen(),this._initialized=!0,this)},val:function(){var t=[];return e("li.filter-item",this.$filters).each(function(){t.push({field:e("[name=field]",e(this)).val(),operator:e("[name=operator]",e(this)).val(),value:e("[name=value]",e(this)).val()})}),this.$input.val(JSON.stringify(t)),t},_render:function(){this.$input.parent().append(this.template),this.$filters=this.$input.siblings(".es-filter"),this.$createBtn=this.$input.siblings('button[handle="create"]');for(var t=JSON.parse(this.$input.val()),e=0;e<t.length;e++)this._renderItem(t[e]);return this},_renderItem:function(t){var e=this.$filters.append(this.itemTemplate).children("li:last"),i=this.settings.mapping[t.field],n=t.operator;return e.find('[name="field"]').val(t.field).attr("format",i).dropdownSelector({options:this.fields}),e.find('[name="operator"]').val(t.operator).dropdownSelector({options:this._getFieldOperators(t.field)}),e.find('[name="value"]').val(t.value).attr("format",n),e.find('[name="value"]').attr("title",this.valueMap[n].tooltip).tooltip({container:"body"}),this},_listen:function(){var t=this;return this.$createBtn.click(function(){t._create()}),this.$filters.on("click",'[handle="delete"]',function(i){t._delete(e(i.target).closest(".filter-item"))}),this.$filters.on("change",'[name="field"]',function(i){t._changeField(e(i.target).closest(".filter-item"))}),this.$filters.on("change",'[name="operator"]',function(i){t._changeOperator(e(i.target).closest(".filter-item"))}),this},_create:function(){var t=this._getFieldOperators(this.fields[0]);return this._renderItem({field:this.fields[0],operator:t[0].value,value:""}),this.$input.trigger("esFilter.create"),this},_delete:function(t){return e("input:text",t).tooltip("destroy"),t.remove(),this.$input.trigger("esFilter.delete"),this},_changeField:function(t){var e=t.find('[name="field"]'),i=t.find('[name="operator"]'),n=t.find('[name="value"]'),s=this.settings.mapping[e.val()],a=i.val();return s!=e.attr("format")&&(e.attr("format",s),this._updateValue(n,a),this._updateOperator(i,s)),this.$input.trigger("esFilter.changeField"),this},_changeOperator:function(t){var e=t.find('[name="operator"]'),i=t.find('[name="value"]'),n=e.val();this._updateValue(i,n)},_updateOperator:function(t,e){t.dropdownSelector("updateOptions",this.operatorMap[e])},_updateValue:function(t,e){t.val(""),t.attr("format",e).attr("data-original-title",this.valueMap[e]?this.valueMap[e].tooltip:"")},_getFields:function(){var t=[];for(var e in this.settings.mapping)"@timestamp"!=e&&t.push(e);return this.settings.mapping["@timestamp"]&&t.push("@timestamp"),t},_getFieldOperators:function(t){var e=this.settings.mapping[t]?this.settings.mapping[t]:"string";return this.operatorMap[e]}},e.fn.esFilter=function(t){if(this.data("instance.esfilter"))return this.data("instance.esfilter");var e=new i(this,t);return e.initialize(),this.data("instance.esfilter",e)?e:void 0}}(window,$),function(t,e){var i=function(t,e){this.$element=[],this.$wrap=[],this.settings={},this.enabled=!1,this.initialize(t,e)};i.prototype={templateOfWrap:'<ul class="es-term-ranges"></ul>',templateOfCreate:'<li class="add-range-item"><button class="btn btn-default btn-block"type="button"handle="create"><i class="glyphicon glyphicon-plus text-primary"handle="create"></i></button></li>',defaults:{model:[{from:"*",to:100},{from:101,to:"*"}]},initialize:function(t,i){if(this.enabled)return this;this.$element=t,this.settings=e.extend({},this.defaults,this.$element.data(),i),this.enabled=!0;var n=this.$element.val()?JSON.parse(this.$element.val()):[];return n.length&&(this.settings.model=n),this._render()._listen()},createItem:function(t){var i=this._getItemHtml(t||{from:"",to:""});return e('[handle="create"]',this.$wrap).closest("li").before(i),this.$wrap.find(".range-item:last input:text").tooltip({title:'请输入数字或"*"',container:"body"}),this},deleteItem:function(t){return t.remove(),this},toString:function(){var t=[];return e("li.range-item",this.$wrap).each(function(){t.push({from:e(this).find('[name="from"]').val(),to:e(this).find('[name="to"]').val()})}),this.$element.val(JSON.stringify(t)),this},destroy:function(){return this.$wrap.find("li").remove(),this.$element.unwrap().val("[]").data("obj.esTermRanges",null),this},_render:function(){this.$element.wrap(this.templateOfWrap),this.$wrap=this.$element.parent();for(var t="",e=0;e<this.settings.model.length;e++){var i=this.settings.model[e];t+=this._getItemHtml(i)}return t+=this.templateOfCreate,this.$wrap.append(t),this.$wrap.find("input:text").tooltip({title:'请输入数字或"*"',container:"body"}),this},_getItemHtml:function(t){return'<li class="range-item"><input class="form-control"name="from"value="'+t.from+'"/>&nbsp;~&nbsp;<input class="form-control"name="to"value="'+t.to+'"/><i class="glyphicon glyphicon-minus-sign text-danger"handle="delete"></i></li>'},_listen:function(){var t=this;return this.$wrap.on("click",'[handle="create"]',function(){t.createItem()}),this.$wrap.on("click",'[handle="delete"]',function(){t.deleteItem(e(this).closest("li"))}),this}},e.fn.esTermRanges=function(t,n){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("obj.esTermRanges");if(!r){if("destroy"==t)return;r=new i(s,a),s.data("obj.esTermRanges",r)}"string"==typeof t&&r[t](n)})}}(window,$),function(t,e,i){var n=function(t,e){this.$element=[],this.tagName="",this.settings={},this.enabled=!1,this.initialize(t,e)};n.prototype={defaults:{loadingTag:'<i class="iconfont icon-loading2 animation-spin"></i>'},initialize:function(t,i){return this.enabled?this:(this.$element=t,this.tagName=t[0].tagName,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this.$element)},start:function(){"BUTTON"==this.tagName&&(this.$element.prop("disabled",!0),this.$element.append(" "+this.settings.loadingTag))},done:function(){"BUTTON"==this.tagName&&(this.$element.prop("disabled",!1),this.$element.find("i.animation-spin").remove())},destroy:function(){return this.$element}},e.fn.loading=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("$.loading");if(!r){if("destroy"==t)return;r=new n(s,a),s.data("$.loading",r)}"string"==typeof t&&r[t](i)})}}(window,$,_),function(t,e,i){var n=function(t,e){this.$element=[],this.settings={},this.enabled=!1,this.$dragger=[],this.$rightResizer=[],this.$leftResizer=[],this.initialize(t,e)};n.prototype={defaults:{dragger:".dragger",rightResizer:".resizer-right",leftResizer:".resizer-left"},initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend({},this.defaults,this.$element.data(),i),this.$dragger=e(this.settings.dragger,this.$element),this.$rightResizer=e(this.settings.rightResizer,this.$element),this.$leftResizer=e(this.settings.leftResizer,this.$element),this.enabled=!0,this._render()._listen())},_render:function(){return this},_listen:function(){var t=this;return this.$dragger.mousedown(function(e){t._drag(e)}),this.$dragger.children("[stop-propagation]").mousedown(function(t){t.stopPropagation()}),this.$rightResizer.mousedown(function(e){t._resize(e,"right")}),this.$leftResizer.mousedown(function(e){t._resize(e,"left")}),this.$element.bind("dragged.resizableDragger",function(){}),this.$element.bind("resized.resizableDragger",function(){}),this},_drag:function(t){var e=this,i=this.$element.position(),n={x:t.clientX,y:t.clientY};document.onmousemove=function(t){var s={x:t.clientX,y:t.clientY};e.$element.css({top:i.top+s.y-n.y,left:i.left+s.x-n.x})},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,e._adjustPosition()}},_resize:function(t,e){var i=this,n=this.$element.position(),s={height:this.$element.height(),width:this.$element.width()},a={x:t.clientX,y:t.clientY};document.onmousemove=function(t){var r={x:t.clientX,y:t.clientY},o=r.x-a.x;"left"==e?i.$element.css({height:s.height+r.y-a.y,width:s.width-o,left:n.left+o+4}):i.$element.css({height:s.height+r.y-a.y,width:s.width+o})},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,i._adjustSize(),i._adjustPosition()}},_adjustPosition:function(){var t=this,e=this.$element.position(),i={};e.top<10?i.top=0:i.top=this._getAdjustNum(e.top),e.left<10?i.left=0:i.left=this._getAdjustNum(e.left),this.$element.animate(i,200,"swing",function(){t.$element.trigger("dragged.resizableDragger")})},_adjustSize:function(){var t=this,e={height:this.$element.height(),width:this.$element.width()},i={};i.height=e.height<200?200:this._getAdjustNum(e.height),i.width=e.width<300?300:this._getAdjustNum(e.width),this.$element.animate(i,200,"swing",function(){t.$element.trigger("resized.resizableDragger")})},_getAdjustNum:function(t){return 10*Math.round(t/10)}},e.fn.resizableDragger=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.resizableDragger");if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.resizableDragger",r)}"string"==typeof t&&r[t](i)})}}(window,$,_),function(t,e,i){var n=function(t,e){this.$wrap=[],this.$element=[],this.$btn=[],this.$dropdown=[],this.$keywords=[],this.checked=[],this.page=0,this.more=!1,this.multiple,this.settings={},this.enabled=!1,this.initialize(t,e)};n.prototype={defaults:{placeholder:"请选择",options:[],search:!1,separator:" , "},template:'<button class="btn btn-default dropdown-toggle"type="button"><span class="text">请选择</span>&nbsp;<span class="caret font-gray"></span></button><div class="dropdown-menu"><div class="form-keywords option-keywords hide"><i class="glyphicon glyphicon-search"></i><input class="form-control" name="__keywords__" /></div><ul class="option-list"></ul><div class="tips">暂无纪录</div></div>',templateOfWrap:'<div class="btn-group unselectable"></div>',templateOfLi:'<%_.each(options,function(item){%><li value="<%= item.value ? item.value : item.id %>"name="<%= item.name %>"class="<% if (item.divider) { %> divider<% } %> <% if (item.disabled) { %> disabled<% } %> <% if (item.checked) { %> active<% } %>"><%if(!item.divider){%><%=item.name%><i class="glyphicon glyphicon-ok"></i><%}%></li><%})%>',templateOfSelectOption:'<%_.each(options,function(item){%><option value="<%= item.value %>"<%if(item.disabled){%>disabled<%}%>><%=item.name%></option><%})%>',initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this.multiple=t.prop("multiple"),this._setChecked()._render()._listen())},open:function(){return this.settings.ajax&&0==this.page&&(this.page=1,this.more=!0,this._getPageDataThenRender()),this.$wrap.addClass("open"),this.$element.trigger("select.open"),this},close:function(){return this.$wrap.removeClass("open"),this.$element.trigger("select.close"),this},check:function(t){"string"==typeof t&&(t=this.$dropdown.find('.option-list [value="'+t+'"]'));var e={value:t.attr("value"),name:t.attr("name")},i='<option value="'+e.value+'" selected>'+e.name+"</option>";return this.multiple?(t.addClass("active"),this.$element.append(i).trigger("change")):(t.addClass("active").siblings(".active").removeClass("active"),this.$element.html(i).trigger("change"),this.close()),this},checkout:function(t){return this.multiple?(t.removeClass("active"),this.$element.children('[value="'+t.attr("value")+'"]').remove(),this.$element.trigger("change"),this):this},getChecked:function(t){var i=[];return this.$element.children(":selected").each(function(){i.push({name:e(this).text(),value:e(this).attr("value")})}),i},disabled:function(t){this.$btn.prop("disabled",!!t)},updateOptions:function(t){this._renderOptions(t);var i=this,n="";this.$element.children("option:selected").each(function(){n=e(this).val(),e('li[value=""]',i.$dropdown).length||e(this).remove()});var s=this.$dropdown.find(".option-list li:first");return s.length?s.trigger("click"):(this.$btn.children(".text").text(this.settings.placeholder),this.$element.trigger("change")),this},_render:function(){return this.$element.hide().wrap(this.templateOfWrap),this.$wrap=this.$element.parent(),this.$wrap.prepend(this.template),this.$btn=this.$wrap.children("button"),this.$dropdown=this.$wrap.children(".dropdown-menu"),this.$keywords=this.$dropdown.find('[name="__keywords__"]'),this.multiple&&this.$dropdown.children(".option-list").addClass("multiple"),this.settings.ajax||this._renderOptionsFromSelectAndSetting(),this.settings.search&&this.$keywords.parent().removeClass("hide"),this._renderChecked()},_renderOptionsFromSelectAndSetting:function(){var t=[],n="",s={};this.$element.children("option").each(function(){"____"==(n=e(this).text())?t.push({divider:!0}):t.push({name:n,value:e(this).val(),disabled:e(this).prop("disabled")})});for(var a=0;a<this.settings.options.length;a++)s=this.settings.options[a],n="string"==typeof s?s:s.name,i.findWhere(t,{name:n})||t.push(s);return this._renderOptions(t)},_renderOptionsFromServer:function(t,i){if(this.more){var n=e.extend(!0,{},this.settings.ajax),s={keywords:t,page:i},a=this;n.data=a.settings.ajax.data(s),n.success=function(t){var e=a.settings.ajax.success(t,s);a._appendOptions(e.options),a.more=!!e.more},e.ajax(n)}},_renderOptions:function(t){return this.$dropdown.children(".option-list").empty(),this._appendOptions(t)},_appendOptions:function(t){this.settings.placeholder&&(this.settings.ajax&&!keywords&&1==page&&t.unshift({name:this.settings.placeholder,value:""}),this.settings.ajax||t.unshift({name:this.settings.placeholder,value:""}));var e=i.template(this.templateOfLi)({options:this._formatOptions(t)});return this.$dropdown.children(".option-list").append(e),this},_formatOptions:function(t){for(var e=0;e<t.length;e++){var n=t[e];"string"==typeof n&&(t[e]={name:n,value:n}),t[e].checked=!!i.findWhere(this.checked,{value:t[e].value})}return t},_setChecked:function(){return this.checked=this.getChecked(),this},_renderChecked:function(){var t=this.$btn.children(".text"),e=i.pluck(this.checked,"name");return t.text(e.join(this.settings.separator)||this.settings.placeholder),this},_listen:function(){var n=this;return this.$btn.click(function(){n.$wrap.hasClass("open")?n.close():n.open()}),e(t).bind("click",function(t){e(t.target).is(n.$btn)||e(t.target).closest(".btn-group").is(n.$wrap)||n.$wrap.hasClass("open")&&n.close()}),this.$dropdown.children(".option-list").scroll(i.throttle(function(){var t=e(this);t.get(0).scrollHeight-t.height()-t.scrollTop()<=40&&n._getPageDataThenRender()},500,{leading:!1})),this.$keywords.change(function(){n._search()}).keydown(function(t){if(13==t.keyCode)return e(this).trigger("change"),!1}),this.$dropdown.on("click","li",function(){e(this).hasClass("disabled")||e(this).hasClass("divider")||e(this).hasClass("active")&&!n.multiple||(e(this).hasClass("active")?n.checkout(e(this)):n.check(e(this)))}),this.$element.change(function(){n._setChecked()._renderChecked()}),this},_getPageDataThenRender:function(){this._renderOptionsFromServer(this.$keywords.val(),this.page++)},_search:function(){this.page=1,this.more=!0,this.$dropdown.children(".option-list").empty(),this._getPageDataThenRender()}},e.fn.select=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.select");if("select"==e(this)[0].tagName.toLowerCase()){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.select",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t,e,i){var n=function(t,e){this.$wrap=[],this.$element=[],this.settings={},this.enabled=!1,this.initialize(t,e)};n.prototype={defaults:{on:"yes",off:"no"},wrap:'<span class="switch"></span>',template:'<span class="slider"></span>',initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this._render()._listen())},on:function(){return this.$element.val(this.settings.on).trigger("change"),this.$element.trigger("switch-on"),this},off:function(){return this.$element.val(this.settings.off).trigger("change"),this.$element.trigger("switch-off"),this},rollback:function(){var t=this.$element.val()==this.settings.on?this.settings.off:this.settings.on;return this.$element.val(t).trigger("change"),this},disable:function(t){return this.$element.prop("disabled",!!t).trigger("change"),this.$element.trigger("switch-disable"),this},_render:function(){return this.$element.hide().wrap(this.wrap),this.$wrap=this.$element.parent(),this._renderSwitch(),this.$wrap.prepend(this.template),this},_renderSwitch:function(){this.$element.val()===this.settings.on?this.$wrap.removeClass("switch-off").addClass("switch-on"):this.$wrap.removeClass("switch-on").addClass("switch-off"),this.$element.prop("disabled")?this.$wrap.addClass("switch-disabled"):this.$wrap.removeClass("switch-disabled")},_listen:function(){var t=this;return this.$element.change(function(){t._renderSwitch()}),this.$wrap.click(function(){e(this).hasClass("switch-disabled")||(e(this).hasClass("switch-on")?t.off():t.on())}),this}},e.fn.switch=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.switch");if("input"==e(this)[0].tagName.toLowerCase()){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.switch",r)}"string"==typeof t&&r[t](i)}})}}(window,$,_),function(t,e,i){var n=function(t,e){this.$element=[],this.settings={},this.enabled=!1,this.rules={},this.errors={},this.submitted=!1,this.initialize(t,e)};n.prototype={defaults:{rules:{},showError:function(t,i,n){var s=e('[name="'+t+'"]',n),a=s.closest(".form-input"),r=a.children(".validator-error").length?a.children(".validator-error"):a.append('<p class="validator-error"></p>').children(".validator-error");s.focus(),s.closest(".form-group").addClass("has-error"),r.text(i)},hideError:function(t,i){var n=e('[name="'+t+'"]',i),s=n.closest(".form-input").children(".validator-error");n.closest(".form-group").removeClass("has-error"),s.empty()}},methods:{required:function(t,e,i){return t.length>0},number:function(t,e,i){return!t.length||/^(?:-?\d+|-?\d{1,3}(?:,\d{3})+)?(?:\.\d+)?$/.test(t)},int:function(t,e,i){return!t.length||/^\d+$/.test(t)},length:function(t,e,i){return!t.length||t.length>=parseInt(i[0])&&t.length<=parseInt(i[1])},minLength:function(t,e,i){return!t.length||t.length>=parseInt(i)},maxLength:function(t,e,i){return!t.length||t.length<=parseInt(i)},range:function(t,e,i){return!t.length||"string"!=typeof t||parseFloat(t)>=parseFloat(i[0])&&parseFloat(t)<=parseFloat(i[1])},min:function(t,e,i){return!t.length||"string"!=typeof t||parseFloat(t)>=parseFloat(i)},max:function(t,e,i){return!t.length||"string"!=typeof t||parseFloat(t)<=parseFloat(i)},equal:function(t,e,i){return!t.length||t==i},email:function(t,e,i){return!t.length||/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)},mobile:function(t,e,i){return!t.length||/^1[34578][0-9]{9}$/.test(t)},date:function(t,e,i){return!t.length||("yyyy-dd-mm"==i||"yyyy/dd/mm"==i?/^(\d{4})[\/\-](0\d{1}|1[0-2])[\/\-](0\d{1}|[12]\d{1}|3[01])$/.test(t):"yyyy-dd"==i||"yyyy/dd"==i?/^(\d{4})[\/\-](0\d{1}|1[0-2])$/.test(t):"yyyy"==i?/^(\d{4})$/.test(t):/^\d{4}[\/\-](0?[1-9]|1[012])[\/\-](0?[1-9]|[12][0-9]|3[01])$/.test(t))},time:function(t,e,i){return!t.length||("hh"==i?/^(0\d{1}|1\d{1}|2[0-3])$/.test(t):"hh:mm"==i?/^(0\d{1}|1\d{1}|2[0-3]):([0-5]\d{1})$/.test(t):"hh:mm:ss"==i?/^(0\d{1}|1\d{1}|2[0-3]):[0-5]\d{1}:([0-5]\d{1})$/.test(t):/^(0\d{1}|1\d{1}|2[0-3]):[0-5]\d{1}(:([0-5]\d{1}))?$/.test(t))},userName:function(t,e,i){return!t.length||/^[a-z]+[0-9]*$/.test(t)}},messages:{required:"这是必填项",number:"请输入整数或小数",int:"请输入整数",mobile:"请输入手机号",length:"请输入{p0}至{p1}位字符",minLength:"请输入至少{p0}位字符",maxLength:"最多输入{p0}位字符",range:"输入值大小在{p0}到{p1}之间",min:"输入值需大于或等于{p0}",max:"输入值需小于或等于{p0}",equal:"输入值需等于{p0}",email:"邮件格式不正确",date:"日期格式不正确",time:"时间格式不正确",userName:"请输入正确的用户名(字母或字母+数字)"},initialize:function(t,i){return this.enabled?this:(this.$element=t,this.settings=e.extend(!0,{},this.defaults,this.$element.data(),i),this.enabled=!0,this._setRules()._listen(),this.$element)},destroy:function(){return this.enabled=!1,this.$element.data("$.validator",null),this.$element},valid:function(t){if(t)return this._checkField(t),!!this.errors[t];this.submitted=!0;for(var t in this.rules)this._checkField(t);return this.isValid()},isValid:function(){return e.isEmptyObject(this.errors)},addError:function(t,e){this.errors[t]=e,"function"==typeof this.settings.showError&&this.settings.showError(t,e,this.$element)},removeError:function(t){delete this.errors[t],"function"==typeof this.settings.showError&&this.settings.hideError(t,this.$element)},_listen:function(){var t=this;for(var i in this.rules)e('[name="'+i+'"]',this.$element).change(function(){t.submitted&&t.valid(e(this).attr("name"))});for(var i in this.rules)e('[name="'+i+'"]',this.$element).keyup(function(){t.submitted&&t.valid(e(this).attr("name"))});return this.$element.submit(function(){t.valid()}),e('[type="number"]',this.$element).keydown(function(t){return t.keyCode<=20||!!(t.key+"").match(/[0-9\-\.]/)}),this},_setRules:function(){var t={};for(var e in this.settings.rules)t[e]=this._parseRules(this.settings.rules[e]);return this.rules=t,this},_parseRules:function(t){for(var e=t.split("|"),i="",n=[],s=0;s<e.length;s++)if(i=e[s]){var a=i.split(":"),r=a[0],o=a[1],l=o?o.match(/\`.*\`$/):"",h=o?o.split("`")[0]:"",d=h?h.split(","):[];n.push({name:r,param:d,message:l?l[0].split("`")[1]:this._getRuleMessage(r,d)})}return n},_getRuleMessage:function(t,e){var i=this.messages[t]||"";return i&&e.length&&(i=this._decorateMessage(i,e)),i},_decorateMessage:function(t,e){var i=t.match(/\{p[0-9]?\}/g);if(!i)return t;for(var n=0;n<i.length;n++){var s=i[n],a=parseInt(s[2]);t=t.replace("{p"+a+"}",e[a])}return t},_checkField:function(t){try{for(var e=this.rules[t]||{},i=0;i<e.length;i++)if(!this._checkRule(t,e[i]))return!1;return!0}catch(t){console.log(t)}},_checkRule:function(t,i){var n=e('[name="'+t+'"]',this.$element);if(!n.length)return!0;var s=e.getValByName(t,this.$element);return this.methods[i.name](s,n,i.param)?(this.removeError(t),!0):(this.addError(t,i.message),!1)}},e.fn.validator=function(t,i){return this.each(function(){var s=e(this),a="object"==typeof t?t:{},r=s.data("instance.validator");if("FORM"==e(this)[0].tagName){if(!r){if("destroy"==t)return;r=new n(s,a),s.data("instance.validator",r)}"string"==typeof t&&r[t](i)}})},jQuery.extend({addValidatorMethods:function(t,e,i){var s=n.prototype.methods,a=n.prototype.messages;return!s[t]&&(s[t]=e,a[t]=i,!0)}})}(window,$,_);